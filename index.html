<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶∏‡¶æ‡¶≤‡ßá‡¶π ‡¶∏‡ßç‡¶ü‡ßÅ‡¶°‡¶ø‡¶ì - ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶™‡¶®‡¶æ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <!-- Firebase App (the core Firebase SDK) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <!-- Firebase Database -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <!-- Firebase Auth -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; min-height: 100vh; }
        .container { max-width: 1400px; margin: 0 auto; background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); overflow: hidden; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; }
        .header h1 { font-size: 32px; margin-bottom: 10px; }
        .user-info { background: rgba(255,255,255,0.2); padding: 15px; border-radius: 10px; margin-top: 15px; display: flex; justify-content: space-between; align-items: center; }
        .tabs { display: flex; background: #f8f9fa; border-bottom: 3px solid #667eea; overflow-x: auto; }
        .tab { flex: 1; min-width: 150px; padding: 20px; text-align: center; cursor: pointer; font-weight: bold; background: #f8f9fa; border: none; font-size: 16px; transition: all 0.3s; }
        .tab:hover { background: #e9ecef; }
        .tab.active { background: white; color: #667eea; border-bottom: 3px solid #667eea; margin-bottom: -3px; }
        .content { padding: 30px; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .btn { background: #667eea; color: white; padding: 12px 25px; border: none; border-radius: 8px; font-size: 14px; cursor: pointer; font-weight: bold; transition: all 0.3s; margin: 5px; }
        .btn:hover { background: #764ba2; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .btn-success { background: #28a745; }
        .btn-success:hover { background: #218838; }
        .btn-danger { background: #dc3545; }
        .btn-danger:hover { background: #c82333; }
        .btn-warning { background: #ffc107; color: #212529; }
        .btn-warning:hover { background: #e0a800; }
        .btn-info { background: #17a2b8; }
        .btn-info:hover { background: #138496; }
        .btn-sm { padding: 8px 15px; font-size: 12px; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { padding: 20px; border-radius: 12px; color: white; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .stat-card.green { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); }
        .stat-card.red { background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%); }
        .stat-card.blue { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .stat-card.purple { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); color: #333; }
        .stat-card h3 { font-size: 13px; margin-bottom: 8px; opacity: 0.9; }
        .stat-card .amount { font-size: 26px; font-weight: bold; }
        .form-card { background: #f8f9fa; padding: 25px; border-radius: 15px; margin-bottom: 25px; box-shadow: 0 3px 10px rgba(0,0,0,0.1); }
        .form-card h3 { color: #667eea; margin-bottom: 20px; font-size: 20px; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .form-group { display: flex; flex-direction: column; }
        .form-group label { font-weight: bold; margin-bottom: 8px; color: #495057; font-size: 14px; }
        .form-group input, .form-group select, .form-group textarea { padding: 10px; border: 2px solid #dee2e6; border-radius: 6px; font-size: 15px; transition: border-color 0.3s; }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: #667eea; }
        .form-group textarea { resize: vertical; min-height: 60px; }
        .transactions-table { width: 100%; border-collapse: collapse; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 3px 10px rgba(0,0,0,0.1); }
        .transactions-table th { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px; text-align: left; font-size: 14px; }
        .transactions-table td { padding: 12px 15px; border-bottom: 1px solid #dee2e6; font-size: 14px; }
        .transactions-table tr:hover { background: #f8f9fa; }
        .badge { padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: bold; display: inline-block; }
        .badge-pending { background: #fff3cd; color: #856404; }
        .badge-processing { background: #cce7ff; color: #004085; }
        .badge-completed { background: #d4edda; color: #155724; }
        .badge-delivered { background: #d1ecf1; color: #0c5460; }
        .badge-cancelled { background: #f8d7da; color: #721c24; }
        .services-grid, .customers-grid, .materials-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px; }
        .service-card, .customer-card, .material-card { background: white; border: 2px solid #dee2e6; padding: 20px; border-radius: 10px; transition: all 0.3s; }
        .service-card:hover, .customer-card:hover, .material-card:hover { border-color: #667eea; box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2); transform: translateY(-2px); }
        .card-header { display: flex; align-items: center; gap: 15px; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 2px solid #dee2e6; }
        .card-avatar { width: 50px; height: 50px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 20px; }
        .card-info h3 { font-size: 16px; margin-bottom: 5px; color: #212529; }
        .card-info p { font-size: 13px; color: #6c757d; }
        .card-stats { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .card-stat { background: #f8f9fa; padding: 10px; border-radius: 6px; text-align: center; }
        .card-stat label { font-size: 11px; color: #6c757d; display: block; margin-bottom: 5px; }
        .card-stat .value { font-size: 16px; font-weight: bold; color: #212529; }
        .chart-container { background: white; padding: 20px; border-radius: 15px; margin-bottom: 20px; box-shadow: 0 3px 10px rgba(0,0,0,0.1); }
        .chart-container h3 { margin-bottom: 15px; color: #495057; font-size: 18px; }
        .empty-state { text-align: center; padding: 60px 20px; color: #6c757d; }
        .empty-state-icon { font-size: 64px; margin-bottom: 20px; }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); }
        .modal-content { background: white; margin: 50px auto; padding: 30px; border-radius: 15px; max-width: 600px; max-height: 90vh; overflow-y: auto; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #dee2e6; }
        .close { font-size: 28px; font-weight: bold; color: #aaa; cursor: pointer; }
        .close:hover { color: #000; }
        .login-container { max-width: 400px; margin: 100px auto; background: white; padding: 40px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .login-header { text-align: center; margin-bottom: 30px; }
        .login-header h2 { color: #667eea; margin-bottom: 10px; }
        .status-badge { padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: bold; margin-left: 8px; }
        .status-active { background: #d4edda; color: #155724; }
        .status-inactive { background: #f8d7da; color: #721c24; }
        .alert { padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .alert-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .alert-danger { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .backup-section { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; }
        .file-input { display: none; }
        .file-label { background: #17a2b8; color: white; padding: 10px 15px; border-radius: 6px; cursor: pointer; display: inline-block; }
        .file-label:hover { background: #138496; }
        .monthly-summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .monthly-card { background: white; border-radius: 10px; padding: 20px; box-shadow: 0 3px 10px rgba(0,0,0,0.1); border-left: 5px solid #667eea; }
        .monthly-card h3 { color: #667eea; margin-bottom: 15px; font-size: 18px; }
        .monthly-stats { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .monthly-stat { background: #f8f9fa; padding: 10px; border-radius: 6px; text-align: center; }
        .monthly-stat label { font-size: 12px; color: #6c757d; display: block; margin-bottom: 5px; }
        .monthly-stat .value { font-size: 16px; font-weight: bold; }
        .monthly-stat.income .value { color: #28a745; }
        .monthly-stat.expense .value { color: #dc3545; }
        .monthly-stat.purchase .value { color: #007bff; }
        .monthly-stat.material .value { color: #ffc107; }
        .monthly-stat.salary .value { color: #6c757d; }
        .material-stock { background: #e7f3ff; padding: 10px; border-radius: 6px; margin-top: 10px; }
        .material-stock .stock-item { display: flex; justify-content: space-between; margin-bottom: 5px; }
        .material-stock .stock-item:last-child { margin-bottom: 0; }
        .stock-low { color: #dc3545; font-weight: bold; }
        .stock-ok { color: #28a745; }
        .order-timeline { margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px; }
        .timeline-item { display: flex; align-items: center; margin-bottom: 10px; }
        .timeline-item:last-child { margin-bottom: 0; }
        .timeline-dot { width: 12px; height: 12px; border-radius: 50%; background: #667eea; margin-right: 10px; }
        .timeline-content { flex: 1; }
        .timeline-date { font-size: 12px; color: #6c757d; }
        
        /* ‡¶®‡¶§‡ßÅ‡¶® ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ */
        .service-categories {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        .service-category {
            background: #f8f9fa;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .service-category.active {
            background: #667eea;
            color: white;
        }
        .priority-high { border-left: 4px solid #dc3545; }
        .priority-medium { border-left: 4px solid #ffc107; }
        .priority-low { border-left: 4px solid #28a745; }
        .service-details {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }
        .service-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        .receipt-container {
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        .receipt-header {
            text-align: center;
            border-bottom: 2px dashed #dee2e6;
            padding-bottom: 15px;
            margin-bottom: 15px;
        }
        .receipt-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }
        .receipt-items {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
        }
        .receipt-items th, .receipt-items td {
            padding: 8px;
            border-bottom: 1px solid #dee2e6;
            text-align: left;
        }
        .receipt-total {
            text-align: right;
            font-weight: bold;
            font-size: 18px;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 2px solid #dee2e6;
        }
        .user-management-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .user-card {
            background: white;
            border: 2px solid #dee2e6;
            padding: 20px;
            border-radius: 10px;
        }
        .credit-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }
        .credit-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        .payment-history {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        /* Firebase Status Indicator */
        #firebaseStatus {
            position: fixed;
            top: 10px;
            right: 10px;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            z-index: 10000;
            display: none;
            color: white;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <!-- Firebase Connection Status -->
    <div id="firebaseStatus">
        <span id="statusText"></span>
    </div>

    <div id="loginScreen">
        <div class="login-container">
            <div class="login-header">
                <h2>üîê ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
                <p style="color: #6c757d;">‡¶∏‡¶æ‡¶≤‡ßá‡¶π ‡¶∏‡ßç‡¶ü‡ßÅ‡¶°‡¶ø‡¶ì ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶™‡¶®‡¶æ ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ</p>
            </div>
            <form onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label>‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ</label>
                    <input type="text" id="loginUsername" required>
                </div>
                <div class="form-group">
                    <label>‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°</label>
                    <input type="password" id="loginPassword" required>
                </div>
                <button type="submit" class="btn btn-success" style="width: 100%; margin-top: 20px;">‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </form>
            <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; font-size: 13px;">
                <strong>‡¶°‡ßá‡¶Æ‡ßã ‡¶≤‡¶ó‡¶á‡¶®:</strong><br>
                ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®: admin / admin123<br>
                ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶æ‡¶∞: manager / manager123<br>
                ‡¶∏‡ßç‡¶ü‡¶æ‡¶´: staff / staff123
            </div>
        </div>
    </div>

    <div class="container" id="mainApp" style="display: none;">
        <div class="header">
            <h1>üñ®Ô∏è ‡¶∏‡¶æ‡¶≤‡ßá‡¶π ‡¶∏‡ßç‡¶ü‡ßÅ‡¶°‡¶ø‡¶ì - ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶™‡¶®‡¶æ</h1>
            <p>‡¶´‡¶ü‡ßã‡¶ï‡¶™‡¶ø, ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü, ‡¶Ü‡¶¨‡ßá‡¶¶‡¶®, ‡¶ï‡¶≤‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü, ‡¶Ö‡¶®‡¶≤‡¶æ‡¶á‡¶® ‡¶¨‡ßÅ‡¶∏‡ßç‡¶ü‡¶ø‡¶Ç</p>
            <div class="user-info">
                <span>üë§ <strong id="currentUserName"></strong> (<span id="currentUserRole"></span>)</span>
                <button class="btn btn-danger btn-sm" onclick="logout()">üö™ ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</button>
            </div>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="switchTab('dashboard')">üìä ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°</button>
            <button class="tab" onclick="switchTab('services')">üõ†Ô∏è ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏</button>
            <button class="tab" onclick="switchTab('orders')">üìã ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞</button>
            <button class="tab" onclick="switchTab('customers')">üë• ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï</button>
            <button class="tab" onclick="switchTab('inventory')">üì¶ ‡¶á‡¶®‡¶≠‡ßá‡¶®‡ßç‡¶ü‡¶∞‡¶ø</button>
            <button class="tab" onclick="switchTab('finance')">üí∞ ‡¶Ü‡¶∞‡ßç‡¶•‡¶ø‡¶ï</button>
            <button class="tab" onclick="switchTab('reports')">üìà ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</button>
            <button class="tab" onclick="switchTab('users')" id="usersTab">üë• ‡¶á‡¶â‡¶ú‡¶æ‡¶∞</button>
            <button class="tab" onclick="switchTab('settings')" id="settingsTab">‚öôÔ∏è ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</button>
        </div>
        
        <div class="content">
            <!-- ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶° ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨ -->
            <div id="dashboard" class="tab-content active">
                <div class="stats-grid">
                    <div class="stat-card green">
                        <h3>‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞</h3>
                        <div class="amount"><span id="todayOrders">0</span></div>
                    </div>
                    <div class="stat-card red">
                        <h3>‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞</h3>
                        <div class="amount"><span id="pendingOrders">0</span></div>
                    </div>
                    <div class="stat-card blue">
                        <h3>‡¶è‡¶á ‡¶Æ‡¶æ‡¶∏‡ßá‡¶∞ ‡¶Ü‡¶Ø‡¶º</h3>
                        <div class="amount">‡ß≥ <span id="monthlyIncome">0</span></div>
                    </div>
                    <div class="stat-card purple">
                        <h3>‡¶Æ‡ßã‡¶ü ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï</h3>
                        <div class="amount"><span id="totalCustomers">0</span></div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <h3>üìà ‡¶∏‡¶™‡ßç‡¶§‡¶æ‡¶π‡ßá‡¶∞ ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞</h3>
                    <canvas id="weeklyOrdersChart"></canvas>
                </div>
                
                <div class="chart-container">
                    <h3>üìä ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡¶Ø‡¶º‡ßÄ ‡¶Ü‡¶Ø‡¶º</h3>
                    <canvas id="serviceRevenueChart"></canvas>
                </div>
            </div>
            
            <!-- ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨ -->
            <div id="services" class="tab-content">
                <div class="form-card">
                    <h3>‚ûï ‡¶®‡¶§‡ßÅ‡¶® ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶Ø‡ßã‡¶ó</h3>
                    <form onsubmit="addService(event)">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶®‡¶æ‡¶Æ *</label>
                                <input type="text" id="serviceName" required>
                            </div>
                            <div class="form-group">
                                <label>‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø *</label>
                                <select id="serviceCategory" required>
                                    <option value="">‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>
                                    <option value="‡¶´‡¶ü‡ßã‡¶ï‡¶™‡¶ø">‡¶´‡¶ü‡ßã‡¶ï‡¶™‡¶ø</option>
                                    <option value="‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü">‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü</option>
                                    <option value="‡¶Ü‡¶¨‡ßá‡¶¶‡¶®">‡¶Ü‡¶¨‡ßá‡¶¶‡¶®</option>
                                    <option value="‡¶ï‡¶≤‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü">‡¶ï‡¶≤‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü</option>
                                    <option value="‡¶õ‡¶¨‡¶ø ‡¶è‡¶°‡¶ø‡¶ü">‡¶õ‡¶¨‡¶ø ‡¶è‡¶°‡¶ø‡¶ü</option>
                                    <option value="‡¶Ö‡¶®‡¶≤‡¶æ‡¶á‡¶® ‡¶¨‡ßÅ‡¶∏‡ßç‡¶ü‡¶ø‡¶Ç">‡¶Ö‡¶®‡¶≤‡¶æ‡¶á‡¶® ‡¶¨‡ßÅ‡¶∏‡ßç‡¶ü‡¶ø‡¶Ç</option>
                                    <option value="‡¶™‡ßá‡¶ú ‡¶™‡ßç‡¶∞‡ßã‡¶Æ‡ßã‡¶∂‡¶®">‡¶™‡ßá‡¶ú ‡¶™‡ßç‡¶∞‡ßã‡¶Æ‡ßã‡¶∂‡¶®</option>
                                    <option value="‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶è‡¶°‡¶ø‡¶ü">‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶è‡¶°‡¶ø‡¶ü</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>‡¶¶‡¶æ‡¶Æ *</label>
                                <input type="number" id="servicePrice" required min="0" step="0.01">
                            </div>
                            <div class="form-group">
                                <label>‡¶∏‡¶Æ‡¶Ø‡¶º (‡¶ò‡¶®‡ßç‡¶ü‡¶æ)</label>
                                <input type="number" id="serviceTime" min="0" step="0.1">
                            </div>
                            <div class="form-group" style="grid-column: 1 / -1;">
                                <label>‡¶¨‡¶ø‡¶¨‡¶∞‡¶£</label>
                                <textarea id="serviceDescription"></textarea>
                            </div>
                        </div>
                        <div style="margin-top: 20px;">
                            <button type="submit" class="btn btn-success">üíæ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£</button>
                            <button type="reset" class="btn">üîÑ ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü</button>
                        </div>
                    </form>
                </div>

                <div class="service-categories" id="serviceCategories">
                    <div class="service-category active" data-category="all">‡¶∏‡¶ï‡¶≤</div>
                    <div class="service-category" data-category="‡¶´‡¶ü‡ßã‡¶ï‡¶™‡¶ø">‡¶´‡¶ü‡ßã‡¶ï‡¶™‡¶ø</div>
                    <div class="service-category" data-category="‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü">‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü</div>
                    <div class="service-category" data-category="‡¶Ü‡¶¨‡ßá‡¶¶‡¶®">‡¶Ü‡¶¨‡ßá‡¶¶‡¶®</div>
                    <div class="service-category" data-category="‡¶ï‡¶≤‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü">‡¶ï‡¶≤‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü</div>
                    <div class="service-category" data-category="‡¶õ‡¶¨‡¶ø ‡¶è‡¶°‡¶ø‡¶ü">‡¶õ‡¶¨‡¶ø ‡¶è‡¶°‡¶ø‡¶ü</div>
                    <div class="service-category" data-category="‡¶Ö‡¶®‡¶≤‡¶æ‡¶á‡¶® ‡¶¨‡ßÅ‡¶∏‡ßç‡¶ü‡¶ø‡¶Ç">‡¶Ö‡¶®‡¶≤‡¶æ‡¶á‡¶® ‡¶¨‡ßÅ‡¶∏‡ßç‡¶ü‡¶ø‡¶Ç</div>
                    <div class="service-category" data-category="‡¶™‡ßá‡¶ú ‡¶™‡ßç‡¶∞‡ßã‡¶Æ‡ßã‡¶∂‡¶®">‡¶™‡ßá‡¶ú ‡¶™‡ßç‡¶∞‡ßã‡¶Æ‡ßã‡¶∂‡¶®</div>
                    <div class="service-category" data-category="‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶è‡¶°‡¶ø‡¶ü">‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶è‡¶°‡¶ø‡¶ü</div>
                </div>

                <div class="services-grid" id="servicesGrid"></div>
            </div>
            
            <!-- ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨ -->
            <div id="orders" class="tab-content">
                <div class="form-card">
                    <h3>‚ûï ‡¶®‡¶§‡ßÅ‡¶® ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞</h3>
                    <form onsubmit="addOrder(event)">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï *</label>
                                <select id="orderCustomer" required>
                                    <option value="">‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ *</label>
                                <select id="orderService" required onchange="updateOrderPrice()">
                                    <option value="">‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ *</label>
                                <input type="number" id="orderQuantity" required min="1" value="1" onchange="updateOrderPrice()">
                            </div>
                            <div class="form-group">
                                <label>‡¶Æ‡ßã‡¶ü ‡¶¶‡¶æ‡¶Æ</label>
                                <input type="number" id="orderTotalPrice" readonly>
                            </div>
                            <div class="form-group">
                                <label>‡¶Ö‡¶ó‡ßç‡¶∞‡¶æ‡¶ß‡¶ø‡¶ï‡¶æ‡¶∞</label>
                                <select id="orderPriority">
                                    <option value="low">‡¶®‡¶ø‡¶Æ‡ßç‡¶®</option>
                                    <option value="medium" selected>‡¶Æ‡¶æ‡¶ß‡ßç‡¶Ø‡¶Æ‡¶ø‡¶ï</option>
                                    <option value="high">‡¶â‡¶ö‡ßç‡¶ö</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</label>
                                <input type="date" id="orderDeliveryDate">
                            </div>
                            <div class="form-group" style="grid-column: 1 / -1;">
                                <label>‡¶¨‡¶ø‡¶∂‡ßá‡¶∑ ‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡ßá‡¶∂‡¶®‡¶æ</label>
                                <textarea id="orderInstructions"></textarea>
                            </div>
                        </div>
                        <div style="margin-top: 20px;">
                            <button type="submit" class="btn btn-success">üíæ ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶Ø‡ßã‡¶ó</button>
                            <button type="reset" class="btn">üîÑ ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü</button>
                        </div>
                    </form>
                </div>

                <!-- ‡¶∞‡¶ø‡¶∏‡¶ø‡¶™‡ßç‡¶ü ‡¶∏‡ßá‡¶ï‡¶∂‡¶® -->
                <div class="form-card">
                    <h3>üßæ ‡¶∞‡¶ø‡¶∏‡¶ø‡¶™‡ßç‡¶ü ‡¶ú‡ßá‡¶®‡¶æ‡¶∞‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                    <form onsubmit="generateReceipt(event)">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶® *</label>
                                <select id="receiptOrder" required>
                                    <option value="">‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>‡¶∞‡¶ø‡¶∏‡¶ø‡¶™‡ßç‡¶ü ‡¶ü‡¶æ‡¶á‡¶™ *</label>
                                <select id="receiptType" required>
                                    <option value="full">‡¶´‡ßÅ‡¶≤ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü</option>
                                    <option value="partial">‡¶Ü‡¶Ç‡¶∂‡¶ø‡¶ï ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü</option>
                                    <option value="due">‡¶¨‡¶æ‡¶ï‡¶ø ‡¶∞‡¶ø‡¶∏‡¶ø‡¶™‡ßç‡¶ü</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß‡¶ø‡¶§ Amount</label>
                                <input type="number" id="receiptPaidAmount" min="0" step="0.01">
                            </div>
                        </div>
                        <div style="margin-top: 20px;">
                            <button type="submit" class="btn btn-success">üßæ ‡¶∞‡¶ø‡¶∏‡¶ø‡¶™‡ßç‡¶ü ‡¶§‡ßà‡¶∞‡¶ø</button>
                            <button type="button" class="btn btn-info" onclick="printReceipt()">üñ®Ô∏è ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                        </div>
                    </form>
                </div>

                <div id="receiptContainer" style="display: none;"></div>

                <!-- ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ -->
                <div style="background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h4 style="margin-bottom: 15px;">üîç ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞</h4>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ</label>
                            <select id="filterStatus" onchange="renderOrders()">
                                <option value="all">‡¶∏‡¶ï‡¶≤ ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ</option>
                                <option value="pending">‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç</option>
                                <option value="processing">‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏‡¶ø‡¶Ç</option>
                                <option value="completed">‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£</option>
                                <option value="delivered">‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡ßç‡¶°</option>
                                <option value="cancelled">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>‡¶Ö‡¶ó‡ßç‡¶∞‡¶æ‡¶ß‡¶ø‡¶ï‡¶æ‡¶∞</label>
                            <select id="filterPriority" onchange="renderOrders()">
                                <option value="all">‡¶∏‡¶ï‡¶≤ ‡¶Ö‡¶ó‡ßç‡¶∞‡¶æ‡¶ß‡¶ø‡¶ï‡¶æ‡¶∞</option>
                                <option value="low">‡¶®‡¶ø‡¶Æ‡ßç‡¶®</option>
                                <option value="medium">‡¶Æ‡¶æ‡¶ß‡ßç‡¶Ø‡¶Æ‡¶ø‡¶ï</option>
                                <option value="high">‡¶â‡¶ö‡ßç‡¶ö</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</label>
                            <input type="date" id="filterDate" onchange="renderOrders()">
                        </div>
                    </div>
                </div>

                <!-- ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶ü‡ßá‡¶¨‡¶ø‡¶≤ -->
                <div style="overflow-x: auto;">
                    <table class="transactions-table">
                        <thead>
                            <tr>
                                <th>‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø</th>
                                <th>‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï</th>
                                <th>‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏</th>
                                <th>‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</th>
                                <th>‡¶¶‡¶æ‡¶Æ</th>
                                <th>‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ</th>
                                <th>‡¶Ö‡¶ó‡ßç‡¶∞‡¶æ‡¶ß‡¶ø‡¶ï‡¶æ‡¶∞</th>
                                <th>‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th>
                                <th>‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶ï‡ßç‡¶∞‡¶Æ</th>
                            </tr>
                        </thead>
                        <tbody id="ordersBody"></tbody>
                    </table>
                </div>
            </div>
            
            <!-- ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨ -->
            <div id="customers" class="tab-content">
                <div style="text-align: right; margin-bottom: 20px;">
                    <button class="btn btn-success" onclick="showAddCustomerModal()">‚ûï ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶Ø‡ßã‡¶ó</button>
                </div>

                <!-- ‡¶¨‡¶æ‡¶ï‡¶ø‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶™‡¶®‡¶æ -->
                <div class="form-card">
                    <h3>üí≥ ‡¶¨‡¶æ‡¶ï‡¶ø‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶™‡¶®‡¶æ</h3>
                    <form onsubmit="addCreditTransaction(event)">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶® *</label>
                                <select id="creditCustomer" required>
                                    <option value="">‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®‡ßá‡¶∞ ‡¶ß‡¶∞‡¶® *</label>
                                <select id="creditType" required>
                                    <option value="due">‡¶¨‡¶æ‡¶ï‡¶ø ‡¶Ø‡ßã‡¶ó</option>
                                    <option value="payment">‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∞‡¶ø‡¶∏‡¶ø‡¶≠</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ *</label>
                                <input type="number" id="creditAmount" required min="0" step="0.01">
                            </div>
                            <div class="form-group">
                                <label>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ *</label>
                                <input type="date" id="creditDate" required>
                            </div>
                            <div class="form-group" style="grid-column: 1 / -1;">
                                <label>‡¶¨‡¶ø‡¶¨‡¶∞‡¶£</label>
                                <textarea id="creditDescription"></textarea>
                            </div>
                        </div>
                        <div style="margin-top: 20px;">
                            <button type="submit" class="btn btn-success">üíæ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£</button>
                        </div>
                    </form>
                </div>

                <!-- ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ -->
                <div class="customers-grid" id="customersGrid"></div>
            </div>
            
            <!-- ‡¶á‡¶®‡¶≠‡ßá‡¶®‡ßç‡¶ü‡¶∞‡¶ø ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨ -->
            <div id="inventory" class="tab-content">
                <div class="form-card">
                    <h3>‚ûï ‡¶®‡¶§‡ßÅ‡¶® ‡¶â‡¶™‡¶ï‡¶∞‡¶£ ‡¶Ø‡ßã‡¶ó</h3>
                    <form onsubmit="addMaterial(event)">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>‡¶â‡¶™‡¶ï‡¶∞‡¶£ ‡¶®‡¶æ‡¶Æ *</label>
                                <input type="text" id="materialName" required>
                            </div>
                            <div class="form-group">
                                <label>‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø *</label>
                                <select id="materialCategory" required>
                                    <option value="">‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>
                                    <option value="‡¶ï‡¶æ‡¶ó‡¶ú">‡¶ï‡¶æ‡¶ó‡¶ú</option>
                                    <option value="‡¶ï‡¶æ‡¶≤‡¶ø">‡¶ï‡¶æ‡¶≤‡¶ø</option>
                                    <option value="‡¶´‡¶ü‡ßã‡¶ï‡¶™‡¶ø ‡¶Æ‡ßá‡¶∂‡¶ø‡¶® ‡¶™‡¶æ‡¶∞‡ßç‡¶ü‡¶∏">‡¶´‡¶ü‡ßã‡¶ï‡¶™‡¶ø ‡¶Æ‡ßá‡¶∂‡¶ø‡¶® ‡¶™‡¶æ‡¶∞‡ßç‡¶ü‡¶∏</option>
                                    <option value="‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü‡¶æ‡¶∞ ‡¶™‡¶æ‡¶∞‡ßç‡¶ü‡¶∏">‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü‡¶æ‡¶∞ ‡¶™‡¶æ‡¶∞‡ßç‡¶ü‡¶∏</option>
                                    <option value="‡¶ï‡¶Æ‡ßç‡¶™‡¶ø‡¶â‡¶ü‡¶æ‡¶∞ ‡¶è‡¶ï‡ßç‡¶∏‡ßá‡¶∏‡¶∞‡¶ø‡¶ú">‡¶ï‡¶Æ‡ßç‡¶™‡¶ø‡¶â‡¶ü‡¶æ‡¶∞ ‡¶è‡¶ï‡ßç‡¶∏‡ßá‡¶∏‡¶∞‡¶ø‡¶ú</option>
                                    <option value="‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø">‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ *</label>
                                <input type="number" id="materialQuantity" required min="0" step="0.01">
                            </div>
                            <div class="form-group">
                                <label>‡¶è‡¶ï‡¶ï</label>
                                <input type="text" id="materialUnit" placeholder="‡¶™‡¶ø‡¶∏, ‡¶∞‡¶ø‡¶Æ, ‡¶≤‡¶ø‡¶ü‡¶æ‡¶∞ ‡¶á‡¶§‡ßç‡¶Ø‡¶æ‡¶¶‡¶ø">
                            </div>
                            <div class="form-group">
                                <label>‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶§‡¶æ ‡¶∏‡ßç‡¶§‡¶∞</label>
                                <input type="number" id="materialAlertLevel" min="0" step="0.01" placeholder="‡¶∏‡ßç‡¶ü‡¶ï ‡¶ï‡¶Æ‡ßá ‡¶ó‡ßá‡¶≤‡ßá ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶®">
                            </div>
                        </div>
                        <div style="margin-top: 20px;">
                            <button type="submit" class="btn btn-success">üíæ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£</button>
                            <button type="reset" class="btn">üîÑ ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü</button>
                        </div>
                    </form>
                </div>

                <div class="materials-grid" id="materialsGrid" style="margin-top: 30px;"></div>
            </div>
            
            <!-- ‡¶Ü‡¶∞‡ßç‡¶•‡¶ø‡¶ï ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨ -->
            <div id="finance" class="tab-content">
                <div class="form-card">
                    <h3>üí∞ ‡¶Ü‡¶Ø‡¶º ‡¶Ø‡ßã‡¶ó</h3>
                    <form onsubmit="addIncome(event)">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ *</label>
                                <input type="date" id="incomeDate" required>
                            </div>
                            <div class="form-group">
                                <label>‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ *</label>
                                <input type="number" id="incomeAmount" required min="0" step="0.01">
                            </div>
                            <div class="form-group">
                                <label>‡¶ß‡¶∞‡¶® *</label>
                                <select id="incomeType" required>
                                    <option value="">‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>
                                    <option value="‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏">‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏</option>
                                    <option value="‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶Ø‡¶º">‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶Ø‡¶º</option>
                                    <option value="‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø">‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø</option>
                                </select>
                            </div>
                            <div class="form-group" style="grid-column: 1 / -1;">
                                <label>‡¶¨‡¶ø‡¶¨‡¶∞‡¶£ *</label>
                                <textarea id="incomeDescription" required></textarea>
                            </div>
                        </div>
                        <div style="margin-top: 20px;">
                            <button type="submit" class="btn btn-success">üíæ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£</button>
                        </div>
                    </form>
                </div>

                <div class="form-card">
                    <h3>üí∏ ‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º ‡¶Ø‡ßã‡¶ó</h3>
                    <form onsubmit="addExpense(event)">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ *</label>
                                <input type="date" id="expenseDate" required>
                            </div>
                            <div class="form-group">
                                <label>‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ *</label>
                                <input type="number" id="expenseAmount" required min="0" step="0.01">
                            </div>
                            <div class="form-group">
                                <label>‡¶ß‡¶∞‡¶® *</label>
                                <select id="expenseType" required>
                                    <option value="">‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>
                                    <option value="‡¶â‡¶™‡¶ï‡¶∞‡¶£">‡¶â‡¶™‡¶ï‡¶∞‡¶£</option>
                                    <option value="‡¶¨‡¶ø‡¶¶‡ßç‡¶Ø‡ßÅ‡ßé ‡¶¨‡¶ø‡¶≤">‡¶¨‡¶ø‡¶¶‡ßç‡¶Ø‡ßÅ‡ßé ‡¶¨‡¶ø‡¶≤</option>
                                    <option value="‡¶≠‡¶æ‡¶°‡¶º‡¶æ">‡¶≠‡¶æ‡¶°‡¶º‡¶æ</option>
                                    <option value="‡¶¨‡ßá‡¶§‡¶®">‡¶¨‡ßá‡¶§‡¶®</option>
                                    <option value="‡¶Æ‡ßá‡¶∞‡¶æ‡¶Æ‡¶§">‡¶Æ‡ßá‡¶∞‡¶æ‡¶Æ‡¶§</option>
                                    <option value="‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø">‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø</option>
                                </select>
                            </div>
                            <div class="form-group" style="grid-column: 1 / -1;">
                                <label>‡¶¨‡¶ø‡¶¨‡¶∞‡¶£ *</label>
                                <textarea id="expenseDescription" required></textarea>
                            </div>
                        </div>
                        <div style="margin-top: 20px;">
                            <button type="submit" class="btn btn-success">üíæ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£</button>
                        </div>
                    </form>
                </div>

                <div class="stats-grid" style="margin-top: 30px;">
                    <div class="stat-card green">
                        <h3>‡¶Æ‡ßã‡¶ü ‡¶Ü‡¶Ø‡¶º</h3>
                        <div class="amount">‡ß≥ <span id="totalIncome">0</span></div>
                    </div>
                    <div class="stat-card red">
                        <h3>‡¶Æ‡ßã‡¶ü ‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º</h3>
                        <div class="amount">‡ß≥ <span id="totalExpense">0</span></div>
                    </div>
                    <div class="stat-card blue">
                        <h3>‡¶®‡¶ø‡¶ü ‡¶≤‡¶æ‡¶≠</h3>
                        <div class="amount">‡ß≥ <span id="netProfit">0</span></div>
                    </div>
                </div>
            </div>
            
            <!-- ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨ -->
            <div id="reports" class="tab-content">
                <div style="text-align: right; margin-bottom: 20px;">
                    <button class="btn" onclick="exportReportToExcel()">üì• ‡¶è‡¶ï‡ßç‡¶∏‡ßá‡¶≤‡ßá ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶°</button>
                </div>
                
                <div class="form-card">
                    <h3>üìä ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</label>
                            <input type="date" id="reportStartDate">
                        </div>
                        <div class="form-group">
                            <label>‡¶∂‡ßá‡¶∑ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</label>
                            <input type="date" id="reportEndDate">
                        </div>
                        <div class="form-group">
                            <label>‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ß‡¶∞‡¶®</label>
                            <select id="reportType">
                                <option value="orders">‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</option>
                                <option value="finance">‡¶Ü‡¶∞‡ßç‡¶•‡¶ø‡¶ï ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</option>
                                <option value="services">‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</option>
                                <option value="customers">‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>&nbsp;</label>
                            <button class="btn btn-success" onclick="generateReport()">‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶§‡ßà‡¶∞‡¶ø</button>
                        </div>
                    </div>
                </div>

                <div id="reportResults"></div>
            </div>

            <!-- ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨ -->
            <div id="users" class="tab-content">
                <div class="form-card">
                    <h3>üë• ‡¶®‡¶§‡ßÅ‡¶® ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                    <form onsubmit="addUser(event)">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ *</label>
                                <input type="text" id="userUsername" required>
                            </div>
                            <div class="form-group">
                                <label>‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° *</label>
                                <input type="password" id="userPassword" required minlength="6">
                            </div>
                            <div class="form-group">
                                <label>‡¶®‡¶æ‡¶Æ *</label>
                                <input type="text" id="userName" required>
                            </div>
                            <div class="form-group">
                                <label>‡¶á‡¶Æ‡ßá‡¶á‡¶≤</label>
                                <input type="email" id="userEmail">
                            </div>
                            <div class="form-group">
                                <label>‡¶´‡ßã‡¶®</label>
                                <input type="text" id="userPhone">
                            </div>
                            <div class="form-group">
                                <label>‡¶∞‡ßã‡¶≤ *</label>
                                <select id="userRole" required>
                                    <option value="staff">‡¶∏‡ßç‡¶ü‡¶æ‡¶´</option>
                                    <option value="manager">‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶æ‡¶∞</option>
                                    <option value="admin">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®</option>
                                </select>
                            </div>
                        </div>
                        <div style="margin-top: 20px;">
                            <button type="submit" class="btn btn-success">üíæ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£</button>
                        </div>
                    </form>
                </div>

                <div class="user-management-grid" id="usersGrid"></div>
            </div>

            <!-- ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨ -->
            <div id="settings" class="tab-content">
                <div class="form-card">
                    <h3>üîê ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®</h3>
                    <div id="settingsAlert"></div>
                    <form onsubmit="changePassword(event)">
                        <div class="form-group">
                            <label>‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° *</label>
                            <input type="password" id="currentPassword" required>
                        </div>
                        <div class="form-group">
                            <label>‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° *</label>
                            <input type="password" id="newPassword" required minlength="6">
                        </div>
                        <div class="form-group">
                            <label>‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶® *</label>
                            <input type="password" id="confirmPassword" required minlength="6">
                        </div>
                        <div style="margin-top: 20px;">
                            <button type="submit" class="btn btn-success">üíæ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£</button>
                        </div>
                    </form>
                </div>

                <div class="form-card">
                    <h3>‚öôÔ∏è ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡¶æ ‡¶§‡¶•‡ßç‡¶Ø</h3>
                    <form onsubmit="saveBusinessInfo(event)">
                        <div class="form-group">
                            <label>‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ</label>
                            <input type="text" id="businessName" value="‡¶∏‡¶æ‡¶≤‡ßá‡¶π ‡¶∏‡ßç‡¶ü‡ßÅ‡¶°‡¶ø‡¶ì">
                        </div>
                        <div class="form-group">
                            <label>‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ</label>
                            <textarea id="businessAddress"></textarea>
                        </div>
                        <div class="form-group">
                            <label>‡¶´‡ßã‡¶®</label>
                            <input type="text" id="businessPhone">
                        </div>
                        <div class="form-group">
                            <label>‡¶á‡¶Æ‡ßá‡¶á‡¶≤</label>
                            <input type="email" id="businessEmail">
                        </div>
                        <div style="margin-top: 20px;">
                            <button type="submit" class="btn btn-success">üíæ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£</button>
                        </div>
                    </form>
                </div>

                <!-- ‡¶è‡¶∏‡¶è‡¶Æ‡¶è‡¶∏ ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ -->
                <div class="form-card">
                    <h3>üì± ‡¶è‡¶∏‡¶è‡¶Æ‡¶è‡¶∏ ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</h3>
                    <form onsubmit="saveSMSSettings(event)">
                        <div class="form-group">
                            <label>‡¶ì‡¶Ø‡¶º‡¶æ‡¶ü‡¶∏‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™/‡¶è‡¶∏‡¶è‡¶Æ‡¶è‡¶∏ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞</label>
                            <input type="text" id="smsPhone" placeholder="+8801XXXXXXXXX">
                        </div>
                        <div class="form-group">
                            <label>‡¶è‡¶∏‡¶è‡¶Æ‡¶è‡¶∏ API Key (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)</label>
                            <input type="text" id="smsApiKey" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶è‡¶∏‡¶è‡¶Æ‡¶è‡¶∏ ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ API key">
                        </div>
                        <div class="form-group">
                            <label>‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü ‡¶è‡¶∏‡¶è‡¶Æ‡¶è‡¶∏ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú</label>
                            <textarea id="smsDefaultMessage" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡ßÅ‡¶§‡•§ ‡¶∏‡¶æ‡¶≤‡ßá‡¶π ‡¶∏‡ßç‡¶ü‡ßÅ‡¶°‡¶ø‡¶ì"></textarea>
                        </div>
                        <div style="margin-top: 20px;">
                            <button type="submit" class="btn btn-success">üíæ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£</button>
                            <button type="button" class="btn btn-info" onclick="testSMS()">üì± ‡¶ü‡ßá‡¶∏‡ßç‡¶ü ‡¶è‡¶∏‡¶è‡¶Æ‡¶è‡¶∏</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- ‡¶Æ‡¶°‡¶æ‡¶≤‡¶ó‡ßÅ‡¶≤‡¶ø -->
    <div id="customerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="customerModalTitle">‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                <span class="close" onclick="closeCustomerModal()">&times;</span>
            </div>
            <form onsubmit="saveCustomer(event)">
                <input type="hidden" id="customerEditId">
                <div class="form-group">
                    <label>‡¶®‡¶æ‡¶Æ *</label>
                    <input type="text" id="customerName" required>
                </div>
                <div class="form-group">
                    <label>‡¶´‡ßã‡¶® *</label>
                    <input type="text" id="customerPhone" required>
                </div>
                <div class="form-group">
                    <label>‡¶á‡¶Æ‡ßá‡¶á‡¶≤</label>
                    <input type="email" id="customerEmail">
                </div>
                <div class="form-group">
                    <label>‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ</label>
                    <textarea id="customerAddress"></textarea>
                </div>
                <div style="margin-top: 20px;">
                    <button type="submit" class="btn btn-success">üíæ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£</button>
                    <button type="button" class="btn" onclick="closeCustomerModal()">‚ùå ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button>
                </div>
            </form>
        </div>
    </div>

    <div id="orderModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="orderModalTitle">‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§</h3>
                <span class="close" onclick="closeOrderModal()">&times;</span>
            </div>
            <div id="orderModalContent"></div>
        </div>
    </div>

    <div id="smsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üì± ‡¶è‡¶∏‡¶è‡¶Æ‡¶è‡¶∏ ‡¶™‡¶æ‡¶†‡¶æ‡¶®</h3>
                <span class="close" onclick="closeSMSModal()">&times;</span>
            </div>
            <form onsubmit="sendSMS(event)">
                <input type="hidden" id="smsCustomerId">
                <div class="form-group">
                    <label>‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ</label>
                    <input type="text" id="smsCustomerName" readonly>
                </div>
                <div class="form-group">
                    <label>‡¶´‡ßã‡¶® ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞</label>
                    <input type="text" id="smsCustomerPhone" readonly>
                </div>
                <div class="form-group">
                    <label>‡¶Æ‡ßá‡¶∏‡ßá‡¶ú *</label>
                    <textarea id="smsMessage" required rows="5"></textarea>
                </div>
                <div style="margin-top: 20px;">
                    <button type="submit" class="btn btn-success">üì§ ‡¶è‡¶∏‡¶è‡¶Æ‡¶è‡¶∏ ‡¶™‡¶æ‡¶†‡¶æ‡¶®</button>
                    <button type="button" class="btn" onclick="closeSMSModal()">‚ùå ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCv5ip4LBBUVgX1Cc2haphfMX5Doz_1IPQ",
            authDomain: "saleh-studio.firebaseapp.com",
            databaseURL: "https://saleh-studio-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "saleh-studio",
            storageBucket: "saleh-studio.firebasestorage.app",
            messagingSenderId: "402125436173",
            appId: "1:402125436173:web:15195253dd7e33fb196c44",
            measurementId: "G-ZPKXHX9C41"
        };

        // Firebase Initialize
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const auth = firebase.auth();

        // Firebase Authentication State Observer
        auth.onAuthStateChanged((user) => {
            if (user) {
                // User is signed in
                console.log("User is signed in:", user.uid);
                updateFirebaseStatus("‡¶Ö‡¶®‡¶≤‡¶æ‡¶á‡¶®", "#28a745");
            } else {
                // User is signed out
                console.log("User is signed out");
                updateFirebaseStatus("‡¶Ö‡¶´‡¶≤‡¶æ‡¶á‡¶®", "#dc3545");
                // Force logout from all devices when password is changed
                if (currentUser) {
                    localStorage.removeItem('currentUser');
                    currentUser = null;
                    document.getElementById('mainApp').style.display = 'none';
                    document.getElementById('loginScreen').style.display = 'block';
                    alert('üîê ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶™‡ßÅ‡¶®‡¶∞‡¶æ‡¶Ø‡¶º ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
                }
            }
        });

        // Firebase Connection State
        database.ref('.info/connected').on('value', (snapshot) => {
            if (snapshot.val() === true) {
                updateFirebaseStatus("‡¶Ö‡¶®‡¶≤‡¶æ‡¶á‡¶®", "#28a745");
            } else {
                updateFirebaseStatus("‡¶Ö‡¶´‡¶≤‡¶æ‡¶á‡¶®", "#dc3545");
            }
        });

        function updateFirebaseStatus(text, color) {
            const statusElement = document.getElementById('firebaseStatus');
            const statusText = document.getElementById('statusText');
            
            statusElement.style.display = 'block';
            statusElement.style.backgroundColor = color;
            statusElement.style.color = 'white';
            statusText.textContent = `Firebase: ${text}`;
        }

        // ‡¶ó‡ßç‡¶≤‡ßã‡¶¨‡¶æ‡¶≤ ‡¶≠‡ßá‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶¨‡¶≤
        let services = [];
        let orders = [];
        let customers = [];
        let materials = [];
        let finances = [];
        let creditTransactions = [];
        let receipts = [];
        let currentUser = null;
        let weeklyOrdersChart = null;
        let serviceRevenueChart = null;
        let businessSettings = {};
        
        // Firebase Realtime Database References
        let servicesRef, ordersRef, customersRef, materialsRef, financesRef, creditTransactionsRef, receiptsRef, businessSettingsRef, usersRef;

        const monthNames = ['‡¶ú‡¶æ‡¶®‡ßÅ‡¶Ø‡¶º‡¶æ‡¶∞‡¶ø', '‡¶´‡ßá‡¶¨‡ßç‡¶∞‡ßÅ‡¶Ø‡¶º‡¶æ‡¶∞‡¶ø', '‡¶Æ‡¶æ‡¶∞‡ßç‡¶ö', '‡¶è‡¶™‡ßç‡¶∞‡¶ø‡¶≤', '‡¶Æ‡ßá', '‡¶ú‡ßÅ‡¶®', '‡¶ú‡ßÅ‡¶≤‡¶æ‡¶á', '‡¶Ü‡¶ó‡¶∏‡ßç‡¶ü', '‡¶∏‡ßá‡¶™‡ßç‡¶ü‡ßá‡¶Æ‡ßç‡¶¨‡¶∞', '‡¶Ö‡¶ï‡ßç‡¶ü‡ßã‡¶¨‡¶∞', '‡¶®‡¶≠‡ßá‡¶Æ‡ßç‡¶¨‡¶∞', '‡¶°‡¶ø‡¶∏‡ßá‡¶Æ‡ßç‡¶¨‡¶∞'];

        // Firebase Authentication Functions
        async function firebaseLogin(username, password) {
            try {
                // Firebase Authentication with email/password
                // Note: We're using username as email for simplicity
                const userCredential = await auth.signInWithEmailAndPassword(`${username}@salehstudio.com`, password);
                return userCredential.user;
            } catch (error) {
                console.error("Firebase login error:", error);
                throw error;
            }
        }

        async function firebaseLogout() {
            try {
                await auth.signOut();
            } catch (error) {
                console.error("Firebase logout error:", error);
            }
        }

        // Firebase Database Functions
        function initializeFirebaseRefs() {
            servicesRef = database.ref('services');
            ordersRef = database.ref('orders');
            customersRef = database.ref('customers');
            materialsRef = database.ref('materials');
            financesRef = database.ref('finances');
            creditTransactionsRef = database.ref('creditTransactions');
            receiptsRef = database.ref('receipts');
            businessSettingsRef = database.ref('businessSettings');
            usersRef = database.ref('users');
            
            setupFirebaseListeners();
        }

        function setupFirebaseListeners() {
            // Services Listener
            servicesRef.on('value', (snapshot) => {
                const firebaseServices = snapshot.val();
                if (firebaseServices) {
                    services = Object.values(firebaseServices);
                    renderServices();
                    updateServiceSelect();
                }
            });

            // Orders Listener
            ordersRef.on('value', (snapshot) => {
                const firebaseOrders = snapshot.val();
                if (firebaseOrders) {
                    orders = Object.values(firebaseOrders);
                    renderOrders();
                    updateDashboard();
                    updateReceiptOrderSelect();
                }
            });

            // Customers Listener
            customersRef.on('value', (snapshot) => {
                const firebaseCustomers = snapshot.val();
                if (firebaseCustomers) {
                    customers = Object.values(firebaseCustomers);
                    renderCustomers();
                    updateCustomerSelect();
                    updateCreditCustomerSelect();
                }
            });

            // Materials Listener
            materialsRef.on('value', (snapshot) => {
                const firebaseMaterials = snapshot.val();
                if (firebaseMaterials) {
                    materials = Object.values(firebaseMaterials);
                    renderMaterials();
                }
            });

            // Finances Listener
            financesRef.on('value', (snapshot) => {
                const firebaseFinances = snapshot.val();
                if (firebaseFinances) {
                    finances = Object.values(firebaseFinances);
                    renderFinances();
                    updateDashboard();
                }
            });

            // Credit Transactions Listener
            creditTransactionsRef.on('value', (snapshot) => {
                const firebaseCreditTransactions = snapshot.val();
                if (firebaseCreditTransactions) {
                    creditTransactions = Object.values(firebaseCreditTransactions);
                }
            });

            // Receipts Listener
            receiptsRef.on('value', (snapshot) => {
                const firebaseReceipts = snapshot.val();
                if (firebaseReceipts) {
                    receipts = Object.values(firebaseReceipts);
                updateReceiptOrderSelect();
                    updateCreditCustomerSelect();
                }
            });

            // Business Settings Listener
            businessSettingsRef.on('value', (snapshot) => {
                const firebaseBusinessSettings = snapshot.val();
                if (firebaseBusinessSettings) {
                    businessSettings = firebaseBusinessSettings;
                    loadBusinessSettings();
                }
            });
        }

        // Firebase Data Saving Functions
        async function saveToFirebase(dataType, data) {
            try {
                const ref = database.ref(dataType);
                await ref.set(data);
                return true;
            } catch (error) {
                console.error(`Error saving ${dataType} to Firebase:`, error);
                return false;
            }
        }

        async function pushToFirebase(dataType, newItem) {
            try {
                const ref = database.ref(dataType);
                const newRef = ref.push();
                newItem.id = newRef.key; // Use Firebase generated ID
                await newRef.set(newItem);
                return newItem.id;
            } catch (error) {
                console.error(`Error pushing ${dataType} to Firebase:`, error);
                return null;
            }
        }

        async function updateInFirebase(dataType, id, updatedItem) {
            try {
                const ref = database.ref(`${dataType}/${id}`);
                await ref.update(updatedItem);
                return true;
            } catch (error) {
                console.error(`Error updating ${dataType} in Firebase:`, error);
                return false;
            }
        }

        async function deleteFromFirebase(dataType, id) {
            try {
                const ref = database.ref(`${dataType}/${id}`);
                await ref.remove();
                return true;
            } catch (error) {
                console.error(`Error deleting ${dataType} from Firebase:`, error);
                return false;
            }
        }

        // Modified Data Management Functions
        async function saveData() {
            // Save to Firebase instead of localStorage
            const data = {
                services: arrayToObject(services),
                orders: arrayToObject(orders),
                customers: arrayToObject(customers),
                materials: arrayToObject(materials),
                finances: arrayToObject(finances),
                creditTransactions: arrayToObject(creditTransactions),
                receipts: arrayToObject(receipts),
                lastUpdated: new Date().toISOString()
            };
            
            // Save business settings separately
            await saveToFirebase('businessSettings', businessSettings);
            
            // Note: We're using Firebase listeners for real-time updates, 
            // so we don't need to manually save all data at once
        }

        function arrayToObject(array) {
            const obj = {};
            array.forEach(item => {
                obj[item.id] = item;
            });
            return obj;
        }

        // Modified Login Function
        async function handleLogin(e) {
            e.preventDefault();
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            
            try {
                // Try Firebase authentication first
                const user = await firebaseLogin(username, password);
                
                // If Firebase auth succeeds, get user data from Firebase database
                const usersSnapshot = await database.ref('users').once('value');
                const firebaseUsers = usersSnapshot.val();
                
                if (firebaseUsers && firebaseUsers[username]) {
                    const userData = firebaseUsers[username];
                    currentUser = { 
                        username, 
                        role: userData.role, 
                        name: userData.name,
                        uid: user.uid
                    };
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    showMainApp();
                } else {
                    // Fallback to local users if not in Firebase
                    const users = getUsers();
                    if (users[username] && users[username].password === password && users[username].isActive) {
                        currentUser = { 
                            username, 
                            role: users[username].role, 
                            name: users[username].name 
                        };
                        localStorage.setItem('currentUser', JSON.stringify(currentUser));
                        showMainApp();
                    } else {
                        alert('‚ùå ‡¶≠‡ßÅ‡¶≤ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ ‡¶¨‡¶æ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°!');
                    }
                }
            } catch (error) {
                // If Firebase auth fails, fallback to local authentication
                console.log("Firebase auth failed, falling back to local auth");
                const users = getUsers();
                if (users[username] && users[username].password === password && users[username].isActive) {
                    currentUser = { 
                        username, 
                        role: users[username].role, 
                        name: users[username].name 
                    };
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    showMainApp();
                } else {
                    alert('‚ùå ‡¶≠‡ßÅ‡¶≤ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ ‡¶¨‡¶æ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°!');
                }
            }
        }

        // Modified Logout Function
        async function logout() {
            if (confirm('‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')) {
                try {
                    await firebaseLogout();
                } catch (error) {
                    console.error("Firebase logout error:", error);
                }
                
                localStorage.removeItem('currentUser');
                currentUser = null;
                document.getElementById('mainApp').style.display = 'none';
                document.getElementById('loginScreen').style.display = 'block';
            }
        }

        // Modified showMainApp Function
        function showMainApp() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            document.getElementById('currentUserName').textContent = currentUser.name;
            document.getElementById('currentUserRole').textContent = currentUser.role === 'admin' ? '‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®' : 
                                                                   currentUser.role === 'manager' ? '‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶æ‡¶∞' : '‡¶∏‡ßç‡¶ü‡¶æ‡¶´';
            
            applyPermissions();
            initializeFirebaseRefs(); // Initialize Firebase listeners
            setDefaultDate();
            
            // These will be updated automatically by Firebase listeners
            // renderServices();
            // renderOrders();
            // renderCustomers();
            // renderMaterials();
            // renderFinances();
            // renderUsers();
            // updateDashboard();
            // updateReceiptOrderSelect();
            // updateCreditCustomerSelect();
            // loadBusinessSettings();
        }

        // Modified Data Loading Function
        async function loadData() {
            try {
                // Try to load data from Firebase first
                const [
                    servicesSnapshot,
                    ordersSnapshot,
                    customersSnapshot,
                    materialsSnapshot,
                    financesSnapshot,
                    creditTransactionsSnapshot,
                    receiptsSnapshot,
                    businessSettingsSnapshot
                ] = await Promise.all([
                    servicesRef.once('value'),
                    ordersRef.once('value'),
                    customersRef.once('value'),
                    materialsRef.once('value'),
                    financesRef.once('value'),
                    creditTransactionsRef.once('value'),
                    receiptsRef.once('value'),
                    businessSettingsRef.once('value')
                ]);

                // Process Firebase data
                services = servicesSnapshot.val() ? Object.values(servicesSnapshot.val()) : [];
                orders = ordersSnapshot.val() ? Object.values(ordersSnapshot.val()) : [];
                customers = customersSnapshot.val() ? Object.values(customersSnapshot.val()) : [];
                materials = materialsSnapshot.val() ? Object.values(materialsSnapshot.val()) : [];
                finances = financesSnapshot.val() ? Object.values(financesSnapshot.val()) : [];
                creditTransactions = creditTransactionsSnapshot.val() ? Object.values(creditTransactionsSnapshot.val()) : [];
                receipts = receiptsSnapshot.val() ? Object.values(receiptsSnapshot.val()) : [];
                
                if (businessSettingsSnapshot.val()) {
                    businessSettings = businessSettingsSnapshot.val();
                } else {
                    // Initialize default business settings
                    businessSettings = {
                        businessName: '‡¶∏‡¶æ‡¶≤‡ßá‡¶π ‡¶∏‡ßç‡¶ü‡ßÅ‡¶°‡¶ø‡¶ì',
                        businessAddress: '',
                        businessPhone: '',
                        businessEmail: '',
                        smsPhone: '',
                        smsApiKey: '',
                        smsDefaultMessage: '‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡ßÅ‡¶§‡•§ ‡¶∏‡¶æ‡¶≤‡ßá‡¶π ‡¶∏‡ßç‡¶ü‡ßÅ‡¶°‡¶ø‡¶ì'
                    };
                    await saveToFirebase('businessSettings', businessSettings);
                }

                // If no data in Firebase, initialize with sample data
                if (services.length === 0) {
                    await initializeSampleData();
                }

            } catch (error) {
                console.error("Error loading data from Firebase:", error);
                // Fallback to localStorage if Firebase fails
                loadFromLocalStorage();
            }
        }

        async function initializeSampleData() {
            // Sample data initialization
            const sampleServices = [
                { id: '1', name: '‡¶è‡¶ï ‡¶™‡ßÉ‡¶∑‡ßç‡¶†‡¶æ ‡¶´‡¶ü‡ßã‡¶ï‡¶™‡¶ø', category: '‡¶´‡¶ü‡ßã‡¶ï‡¶™‡¶ø', price: 2, time: 0.1, description: '‡¶è‡¶ï ‡¶™‡ßÉ‡¶∑‡ßç‡¶†‡¶æ ‡¶ï‡¶æ‡¶≤‡ßã ‡¶∏‡¶æ‡¶¶‡¶æ ‡¶´‡¶ü‡ßã‡¶ï‡¶™‡¶ø' },
                { id: '2', name: '‡¶∞‡¶ô‡¶ø‡¶® ‡¶´‡¶ü‡ßã‡¶ï‡¶™‡¶ø', category: '‡¶´‡¶ü‡ßã‡¶ï‡¶™‡¶ø', price: 10, time: 0.2, description: '‡¶è‡¶ï ‡¶™‡ßÉ‡¶∑‡ßç‡¶†‡¶æ ‡¶∞‡¶ô‡¶ø‡¶® ‡¶´‡¶ü‡ßã‡¶ï‡¶™‡¶ø' },
                { id: '3', name: '‡¶°‡¶ï‡ßÅ‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü', category: '‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü', price: 5, time: 0.1, description: '‡¶è‡¶ï ‡¶™‡ßÉ‡¶∑‡ßç‡¶†‡¶æ ‡¶°‡¶ï‡ßÅ‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü' },
                { id: '4', name: '‡¶´‡¶ü‡ßã ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü (4x6)', category: '‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü', price: 15, time: 0.2, description: '4x6 ‡¶á‡¶û‡ßç‡¶ö‡¶ø ‡¶´‡¶ü‡ßã ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü' },
                { id: '5', name: '‡¶Ö‡¶®‡¶≤‡¶æ‡¶á‡¶® ‡¶´‡¶∞‡ßç‡¶Æ ‡¶™‡ßÇ‡¶∞‡¶£', category: '‡¶Ü‡¶¨‡ßá‡¶¶‡¶®', price: 50, time: 0.5, description: '‡¶Ö‡¶®‡¶≤‡¶æ‡¶á‡¶® ‡¶´‡¶∞‡ßç‡¶Æ ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶∏‡¶π‡¶æ‡¶Ø‡¶º‡¶§‡¶æ' },
                { id: '6', name: '‡¶ï‡¶≤‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü', category: '‡¶ï‡¶≤‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü', price: 200, time: 1, description: '‡¶è‡¶ï‡¶ü‡¶ø ‡¶ï‡¶≤‡¶æ‡¶∞‡ßá ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü' },
                { id: '7', name: '‡¶´‡ßá‡¶∏‡¶¨‡ßÅ‡¶ï ‡¶™‡ßá‡¶ú ‡¶¨‡ßÅ‡¶∏‡ßç‡¶ü‡¶ø‡¶Ç', category: '‡¶Ö‡¶®‡¶≤‡¶æ‡¶á‡¶® ‡¶¨‡ßÅ‡¶∏‡ßç‡¶ü‡¶ø‡¶Ç', price: 500, time: 24, description: '‡ß≠ ‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶™‡ßá‡¶ú ‡¶¨‡ßÅ‡¶∏‡ßç‡¶ü‡¶ø‡¶Ç' },
                { id: '8', name: '‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶è‡¶°‡¶ø‡¶ü‡¶ø‡¶Ç', category: '‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶è‡¶°‡¶ø‡¶ü', price: 300, time: 2, description: '‡¶¨‡ßá‡¶∏‡¶ø‡¶ï ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶è‡¶°‡¶ø‡¶ü‡¶ø‡¶Ç' }
            ];
            
            const sampleCustomers = [
                { id: '1', name: '‡¶∞‡¶´‡¶ø‡¶ï‡ßÅ‡¶≤ ‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ', phone: '‡ß¶‡ßß‡ß≠‡ßß‡ß®-‡ß©‡ß™‡ß´‡ß¨‡ß≠‡ßÆ', email: '', address: '', creditBalance: 0 },
                { id: '2', name: '‡¶∏‡¶æ‡¶≤‡¶Æ‡¶æ ‡¶ñ‡¶æ‡¶§‡ßÅ‡¶®', phone: '‡ß¶‡ßß‡ßÆ‡ßß‡ß©-‡ß™‡ß´‡ß¨‡ß≠‡ßÆ‡ßØ', email: '', address: '', creditBalance: 0 },
                { id: '3', name: '‡¶ú‡¶æ‡¶π‡¶ø‡¶¶ ‡¶π‡¶æ‡¶∏‡¶æ‡¶®', phone: '‡ß¶‡ßß‡ßØ‡ßß‡ß™-‡ß´‡ß¨‡ß≠‡ßÆ‡ßØ‡ß¶', email: '', address: '', creditBalance: 0 }
            ];
            
            const sampleMaterials = [
                { id: '1', name: '‡¶è‡ß™ ‡¶ï‡¶æ‡¶ó‡¶ú', category: '‡¶ï‡¶æ‡¶ó‡¶ú', quantity: 10, unit: '‡¶∞‡¶ø‡¶Æ', alertLevel: 2 },
                { id: '2', name: '‡¶ï‡¶æ‡¶≤‡ßã ‡¶ï‡¶æ‡¶≤‡¶ø', category: '‡¶ï‡¶æ‡¶≤‡¶ø', quantity: 5, unit: '‡¶¨‡ßã‡¶§‡¶≤', alertLevel: 1 },
                { id: '3', name: '‡¶∞‡¶ô‡¶ø‡¶® ‡¶ï‡¶æ‡¶≤‡¶ø', category: '‡¶ï‡¶æ‡¶≤‡¶ø', quantity: 3, unit: '‡¶¨‡ßã‡¶§‡¶≤', alertLevel: 1 }
            ];

            // Save sample data to Firebase
            await saveToFirebase('services', arrayToObject(sampleServices));
            await saveToFirebase('customers', arrayToObject(sampleCustomers));
            await saveToFirebase('materials', arrayToObject(sampleMaterials));
            
            // Initialize empty arrays for other data types
            await saveToFirebase('orders', {});
            await saveToFirebase('finances', {});
            await saveToFirebase('creditTransactions', {});
            await saveToFirebase('receipts', {});
            
            // Initialize users in Firebase
            const users = getUsers();
            await saveToFirebase('users', users);
        }

        function loadFromLocalStorage() {
            const saved = localStorage.getItem('salehStudioData');
            if (saved) {
                const data = JSON.parse(saved);
                services = data.services || [];
                orders = data.orders || [];
                customers = data.customers || [];
                materials = data.materials || [];
                finances = data.finances || [];
                creditTransactions = data.creditTransactions || [];
                receipts = data.receipts || [];
            } else {
                // Initialize with empty arrays
                services = [];
                orders = [];
                customers = [];
                materials = [];
                finances = [];
                creditTransactions = [];
                receipts = [];
            }
            
            // Load business settings from localStorage
            const savedSettings = localStorage.getItem('businessSettings');
            if (savedSettings) {
                businessSettings = JSON.parse(savedSettings);
            } else {
                businessSettings = {
                    businessName: '‡¶∏‡¶æ‡¶≤‡ßá‡¶π ‡¶∏‡ßç‡¶ü‡ßÅ‡¶°‡¶ø‡¶ì',
                    businessAddress: '',
                    businessPhone: '',
                    businessEmail: '',
                    smsPhone: '',
                    smsApiKey: '',
                    smsDefaultMessage: '‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡ßÅ‡¶§‡•§ ‡¶∏‡¶æ‡¶≤‡ßá‡¶π ‡¶∏‡ßç‡¶ü‡ßÅ‡¶°‡¶ø‡¶ì'
                };
            }
        }

        // Modified Data Operation Functions for Firebase
        async function addService(e) {
            e.preventDefault();
            
            const service = {
                id: '', // Let Firebase generate the ID
                name: document.getElementById('serviceName').value,
                category: document.getElementById('serviceCategory').value,
                price: parseFloat(document.getElementById('servicePrice').value),
                time: parseFloat(document.getElementById('serviceTime').value) || 0,
                description: document.getElementById('serviceDescription').value
            };
            
            const newId = await pushToFirebase('services', service);
            if (newId) {
                e.target.reset();
                alert('‚úÖ ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
            } else {
                alert('‚ùå ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
            }
        }

        async function editService(id) {
            const service = services.find(s => s.id === id);
            if (service) {
                document.getElementById('serviceName').value = service.name;
                document.getElementById('serviceCategory').value = service.category;
                document.getElementById('servicePrice').value = service.price;
                document.getElementById('serviceTime').value = service.time;
                document.getElementById('serviceDescription').value = service.description;
                
                // Scroll to form
                document.getElementById('serviceName').scrollIntoView({ behavior: 'smooth' });
                
                // Remove service from Firebase
                await deleteFromFirebase('services', id);
            }
        }

        async function deleteService(id) {
            if (confirm('‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§?')) {
                const success = await deleteFromFirebase('services', id);
                if (success) {
                    alert('‚úÖ ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
                } else {
                    alert('‚ùå ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶Æ‡ßÅ‡¶õ‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
                }
            }
        }

        // Similarly modify all other CRUD operations (addOrder, editOrder, deleteOrder, etc.)
        // to use Firebase functions instead of local arrays

        // Modified User Management for Firebase
        async function addUser(e) {
            e.preventDefault();
            
            const username = document.getElementById('userUsername').value;
            const password = document.getElementById('userPassword').value;
            const name = document.getElementById('userName').value;
            const email = document.getElementById('userEmail').value;
            const phone = document.getElementById('userPhone').value;
            const role = document.getElementById('userRole').value;
            
            // Get current users from Firebase
            const usersSnapshot = await usersRef.once('value');
            const firebaseUsers = usersSnapshot.val() || {};
            
            if (firebaseUsers[username]) {
                alert('‚ùå ‡¶è‡¶á ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ ‡¶á‡¶§‡¶ø‡¶Æ‡¶ß‡ßç‡¶Ø‡ßáÂ≠òÂú®!');
                return;
            }
            
            // Add user to Firebase
            firebaseUsers[username] = {
                password: password,
                role: role,
                name: name,
                email: email,
                phone: phone,
                createdAt: new Date().toISOString(),
                isActive: true
            };
            
            const success = await saveToFirebase('users', firebaseUsers);
            if (success) {
                e.target.reset();
                renderUsers();
                alert('‚úÖ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
            } else {
                alert('‚ùå ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
            }
        }

        // Modified Password Change Function
        async function changePassword(e) {
            e.preventDefault();
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            // Get users from Firebase
            const usersSnapshot = await usersRef.once('value');
            const firebaseUsers = usersSnapshot.val() || {};
            
            if (!firebaseUsers[currentUser.username] || firebaseUsers[currentUser.username].password !== currentPassword) {
                document.getElementById('settingsAlert').innerHTML = '<div class="alert alert-danger">‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶≠‡ßÅ‡¶≤!</div>';
                return;
            }
            
            if (newPassword !== confirmPassword) {
                document.getElementById('settingsAlert').innerHTML = '<div class="alert alert-danger">‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶Æ‡¶ø‡¶≤‡¶õ‡ßá ‡¶®‡¶æ!</div>';
                return;
            }
            
            // Update password in Firebase
            firebaseUsers[currentUser.username].password = newPassword;
            const success = await saveToFirebase('users', firebaseUsers);
            
            if (success) {
                document.getElementById('settingsAlert').innerHTML = '<div class="alert alert-success">‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá! ‡¶∏‡¶ï‡¶≤ ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏ ‡¶•‡ßá‡¶ï‡ßá ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü ‡¶π‡¶¨‡ßá‡•§</div>';
                e.target.reset();
                
                // Trigger logout on all devices by updating a special flag
                await database.ref('forceLogout').set({
                    timestamp: new Date().toISOString(),
                    triggeredBy: currentUser.username
                });
            } else {
                document.getElementById('settingsAlert').innerHTML = '<div class="alert alert-danger">‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!</div>';
            }
        }

        // Listener for forced logout
        database.ref('forceLogout').on('value', (snapshot) => {
            const forceLogoutData = snapshot.val();
            if (forceLogoutData && currentUser) {
                // Check if this logout was triggered by a password change
                if (forceLogoutData.triggeredBy === currentUser.username) {
                    logout();
                }
            }
        });

        // Modified init function
        function init() {
            const saved = localStorage.getItem('currentUser');
            if (saved) {
                currentUser = JSON.parse(saved);
                showMainApp();
            } else {
                document.getElementById('loginScreen').style.display = 'block';
            }
            
            // Load data (will try Firebase first, then fallback to localStorage)
            loadData();
        }

        // Keep the rest of your utility functions and event listeners as they are
        // ...

        // Initialize the application
        init();

        // ‡¶¨‡ßá‡¶∏‡¶ø‡¶ï ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
        function getUsers() {
            const saved = localStorage.getItem('appUsers');
            if (saved) {
                return JSON.parse(saved);
            }
            return {
                admin: { 
                    password: 'admin123', 
                    role: 'admin', 
                    name: '‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®',
                    email: '',
                    phone: '',
                    createdAt: new Date().toISOString(),
                    isActive: true
                },
                manager: { 
                    password: 'manager123', 
                    role: 'manager', 
                    name: '‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶æ‡¶∞',
                    email: '',
                    phone: '',
                    createdAt: new Date().toISOString(),
                    isActive: true
                },
                staff: { 
                    password: 'staff123', 
                    role: 'staff', 
                    name: '‡¶∏‡ßç‡¶ü‡¶æ‡¶´',
                    email: '',
                    phone: '',
                    createdAt: new Date().toISOString(),
                    isActive: true
                }
            };
        }

        function saveUsers(users) {
            localStorage.setItem('appUsers', JSON.stringify(users));
        }

        function applyPermissions() {
            const isAdmin = currentUser.role === 'admin';
            const isManager = currentUser.role === 'manager';
            const isStaff = currentUser.role === 'staff';
            
            // ‡¶∞‡ßã‡¶≤ ‡¶≠‡¶ø‡¶§‡ßç‡¶§‡¶ø‡¶ï ‡¶è‡¶≤‡¶ø‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®/‡¶≤‡ßÅ‡¶ï‡¶æ‡¶®
            document.getElementById('settingsTab').style.display = isAdmin || isManager ? 'block' : 'none';
            document.getElementById('usersTab').style.display = isAdmin ? 'block' : 'none';
            
            // ‡¶∏‡ßç‡¶ü‡¶æ‡¶´‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶´‡¶∞‡ßç‡¶Æ ‡¶°‡¶ø‡¶ú‡ßá‡¶¨‡¶≤
            if (isStaff) {
                const forms = document.querySelectorAll('form');
                forms.forEach(form => {
                    if (!form.id.includes('order') && !form.id.includes('receipt')) {
                        form.querySelectorAll('input, select, textarea').forEach(field => {
                            field.disabled = true;
                        });
                    }
                });
            }
        }

        function loadBusinessSettings() {
            document.getElementById('businessName').value = businessSettings.businessName || '';
            document.getElementById('businessAddress').value = businessSettings.businessAddress || '';
            document.getElementById('businessPhone').value = businessSettings.businessPhone || '';
            document.getElementById('businessEmail').value = businessSettings.businessEmail || '';
            document.getElementById('smsPhone').value = businessSettings.smsPhone || '';
            document.getElementById('smsApiKey').value = businessSettings.smsApiKey || '';
            document.getElementById('smsDefaultMessage').value = businessSettings.smsDefaultMessage || '';
        }

        function setDefaultDate() {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            const todayStr = `${year}-${month}-${day}`;
            
            document.getElementById('incomeDate').value = todayStr;
            document.getElementById('expenseDate').value = todayStr;
            document.getElementById('orderDeliveryDate').value = todayStr;
            document.getElementById('creditDate').value = todayStr;
        }

        // ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü
        function renderServices() {
            const container = document.getElementById('servicesGrid');
            const activeCategory = document.querySelector('.service-category.active').dataset.category;
            
            let filteredServices = services;
            if (activeCategory !== 'all') {
                filteredServices = services.filter(s => s.category === activeCategory);
            }
            
            if (filteredServices.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üõ†Ô∏è</div><h3>‡¶ï‡ßã‡¶® ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶®‡ßá‡¶á</h3><p>‡¶®‡¶§‡ßÅ‡¶® ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</p></div>';
                return;
            }
            
            container.innerHTML = filteredServices.map(service => {
                return `
                    <div class="service-card">
                        <div class="card-header">
                            <div class="card-avatar">${service.name.charAt(0)}</div>
                            <div class="card-info">
                                <h3>${service.name}</h3>
                                <p>${service.category}</p>
                            </div>
                        </div>
                        <div class="card-stats">
                            <div class="card-stat">
                                <label>‡¶¶‡¶æ‡¶Æ</label>
                                <div class="value">‡ß≥ ${service.price.toLocaleString('bn-BD')}</div>
                            </div>
                            <div class="card-stat">
                                <label>‡¶∏‡¶Æ‡¶Ø‡¶º</label>
                                <div class="value">${service.time} ‡¶ò‡¶®‡ßç‡¶ü‡¶æ</div>
                            </div>
                        </div>
                        <div class="service-details">
                            <p>${service.description || '‡¶ï‡ßã‡¶® ‡¶¨‡¶ø‡¶¨‡¶∞‡¶£ ‡¶®‡ßá‡¶á'}</p>
                        </div>
                        <div class="service-actions">
                            <button class="btn btn-sm" onclick="editService(${service.id})" ${currentUser.role === 'staff' ? 'disabled' : ''}>‚úèÔ∏è ‡¶∏‡¶Æ‡ßç‡¶™‡¶æ‡¶¶‡¶®‡¶æ</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteService(${service.id})" ${currentUser.role === 'staff' ? 'disabled' : ''}>üóëÔ∏è ‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü
        function showAddCustomerModal() {
            document.getElementById('customerModalTitle').textContent = '‡¶®‡¶§‡ßÅ‡¶® ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶Ø‡ßã‡¶ó';
            document.getElementById('customerEditId').value = '';
            document.getElementById('customerName').value = '';
            document.getElementById('customerPhone').value = '';
            document.getElementById('customerEmail').value = '';
            document.getElementById('customerAddress').value = '';
            document.getElementById('customerModal').style.display = 'block';
        }

        function showEditCustomerModal(id) {
            const customer = customers.find(c => c.id == id);
            if (customer) {
                document.getElementById('customerModalTitle').textContent = '‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶∏‡¶Æ‡ßç‡¶™‡¶æ‡¶¶‡¶®‡¶æ';
                document.getElementById('customerEditId').value = customer.id;
                document.getElementById('customerName').value = customer.name;
                document.getElementById('customerPhone').value = customer.phone;
                document.getElementById('customerEmail').value = customer.email;
                document.getElementById('customerAddress').value = customer.address;
                document.getElementById('customerModal').style.display = 'block';
            }
        }

        function closeCustomerModal() {
            document.getElementById('customerModal').style.display = 'none';
        }

        async function saveCustomer(e) {
            e.preventDefault();
            
            const id = document.getElementById('customerEditId').value;
            const name = document.getElementById('customerName').value;
            const phone = document.getElementById('customerPhone').value;
            const email = document.getElementById('customerEmail').value;
            const address = document.getElementById('customerAddress').value;
            
            if (id) {
                // ‡¶¨‡¶ø‡¶¶‡ßç‡¶Ø‡¶Æ‡¶æ‡¶® ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶∏‡¶Æ‡ßç‡¶™‡¶æ‡¶¶‡¶®‡¶æ
                const customer = customers.find(c => c.id == id);
                if (customer) {
                    customer.name = name;
                    customer.phone = phone;
                    customer.email = email;
                    customer.address = address;
                    await updateInFirebase('customers', id, customer);
                }
            } else {
                // ‡¶®‡¶§‡ßÅ‡¶® ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶Ø‡ßã‡¶ó
                const newId = await pushToFirebase('customers', {
                    name,
                    phone,
                    email,
                    address,
                    creditBalance: 0
                });
            }
            
            closeCustomerModal();
            alert('‚úÖ ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
        }

        function renderCustomers() {
            const container = document.getElementById('customersGrid');
            
            if (customers.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üë•</div><h3>‡¶ï‡ßã‡¶® ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶®‡ßá‡¶á</h3><p>‡¶®‡¶§‡ßÅ‡¶® ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</p></div>';
                return;
            }
            
            container.innerHTML = customers.map(customer => {
                const customerOrders = orders.filter(o => o.customerId == customer.id);
                const totalSpent = customerOrders.reduce((sum, o) => sum + o.totalPrice, 0);
                const creditBalance = customer.creditBalance || 0;
                
                return `
                    <div class="customer-card">
                        <div class="card-header">
                            <div class="card-avatar">${customer.name.charAt(0)}</div>
                            <div class="card-info">
                                <h3>${customer.name}</h3>
                                <p>üìû ${customer.phone}</p>
                            </div>
                        </div>
                        <div class="card-stats">
                            <div class="card-stat">
                                <label>‡¶Æ‡ßã‡¶ü ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞</label>
                                <div class="value">${customerOrders.length}</div>
                            </div>
                            <div class="card-stat">
                                <label>‡¶Æ‡ßã‡¶ü ‡¶ñ‡¶∞‡¶ö</label>
                                <div class="value">‡ß≥ ${totalSpent.toLocaleString('bn-BD')}</div>
                            </div>
                        </div>
                        <div class="credit-section">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span><strong>‡¶¨‡¶æ‡¶ï‡¶ø:</strong></span>
                                <span style="color: ${creditBalance > 0 ? '#dc3545' : '#28a745'}; font-weight: bold;">
                                    ‡ß≥ ${creditBalance.toLocaleString('bn-BD')}
                                </span>
                            </div>
                            <div class="credit-actions">
                                <button class="btn btn-info btn-sm" onclick="showSMSModal(${customer.id})">üì± ‡¶è‡¶∏‡¶è‡¶Æ‡¶è‡¶∏</button>
                                <button class="btn btn-warning btn-sm" onclick="showCreditHistory(${customer.id})">üìã ‡¶¨‡¶æ‡¶ï‡¶ø ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡¶∞‡¶ø</button>
                            </div>
                        </div>
                        <div style="margin: 15px 0;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span>üìß ‡¶á‡¶Æ‡ßá‡¶á‡¶≤:</span>
                                <span>${customer.email || '‡¶®‡ßá‡¶á'}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>üè† ‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ:</span>
                                <span style="text-align: right;">${customer.address || '‡¶®‡ßá‡¶á'}</span>
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-sm" onclick="showEditCustomerModal(${customer.id})">‚úèÔ∏è ‡¶∏‡¶Æ‡ßç‡¶™‡¶æ‡¶¶‡¶®‡¶æ</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteCustomer(${customer.id})" ${currentUser.role === 'staff' ? 'disabled' : ''}>üóëÔ∏è ‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        async function deleteCustomer(id) {
            if (confirm('‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§?')) {
                const success = await deleteFromFirebase('customers', id);
                if (success) {
                    alert('‚úÖ ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
                } else {
                    alert('‚ùå ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶Æ‡ßÅ‡¶õ‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
                }
            }
        }

        function updateCustomerSelect() {
            const customerSelect = document.getElementById('orderCustomer');
            customerSelect.innerHTML = '<option value="">‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>';
            
            customers.forEach(customer => {
                const option = document.createElement('option');
                option.value = customer.id;
                option.textContent = `${customer.name} (${customer.phone})`;
                customerSelect.appendChild(option);
            });
        }

        function updateServiceSelect() {
            const serviceSelect = document.getElementById('orderService');
            serviceSelect.innerHTML = '<option value="">‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>';
            
            services.forEach(service => {
                const option = document.createElement('option');
                option.value = service.id;
                option.textContent = `${service.name} - ‡ß≥${service.price}`;
                option.setAttribute('data-price', service.price);
                serviceSelect.appendChild(option);
            });
        }

        // ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü
        async function addOrder(e) {
            e.preventDefault();
            
            const customerId = document.getElementById('orderCustomer').value;
            const serviceId = document.getElementById('orderService').value;
            const quantity = parseInt(document.getElementById('orderQuantity').value);
            const totalPrice = parseFloat(document.getElementById('orderTotalPrice').value);
            const priority = document.getElementById('orderPriority').value;
            const deliveryDate = document.getElementById('orderDeliveryDate').value;
            const instructions = document.getElementById('orderInstructions').value;
            
            if (!customerId || !serviceId || quantity <= 0) {
                alert('‚ùå ‡¶∏‡¶ï‡¶≤ ‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡¶†‡¶ø‡¶ï‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®!');
                return;
            }
            
            const customer = customers.find(c => c.id == customerId);
            const service = services.find(s => s.id == serviceId);
            
            const order = {
                customerId: customerId,
                customerName: customer.name,
                serviceId: serviceId,
                serviceName: service.name,
                quantity: quantity,
                unitPrice: service.price,
                totalPrice: totalPrice,
                priority: priority,
                status: 'pending',
                deliveryDate: deliveryDate,
                instructions: instructions,
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString(),
                timeline: [
                    { status: 'pending', date: new Date().toISOString(), note: '‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá' }
                ]
            };
            
            const newId = await pushToFirebase('orders', order);
            if (newId) {
                e.target.reset();
                setDefaultDate();
                alert('‚úÖ ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
            } else {
                alert('‚ùå ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
            }
        }

        function updateOrderPrice() {
            const serviceId = document.getElementById('orderService').value;
            const quantity = parseInt(document.getElementById('orderQuantity').value) || 1;
            
            if (serviceId) {
                const service = services.find(s => s.id == serviceId);
                if (service) {
                    const totalPrice = service.price * quantity;
                    document.getElementById('orderTotalPrice').value = totalPrice;
                }
            } else {
                document.getElementById('orderTotalPrice').value = '';
            }
        }

        function renderOrders() {
            const tbody = document.getElementById('ordersBody');
            const filterStatus = document.getElementById('filterStatus').value;
            const filterPriority = document.getElementById('filterPriority').value;
            const filterDate = document.getElementById('filterDate').value;
            
            let filtered = orders;
            
            if (filterStatus !== 'all') {
                filtered = filtered.filter(o => o.status === filterStatus);
            }
            
            if (filterPriority !== 'all') {
                filtered = filtered.filter(o => o.priority === filterPriority);
            }
            
            if (filterDate) {
                filtered = filtered.filter(o => o.createdAt.split('T')[0] === filterDate);
            }
            
            if (filtered.length === 0) {
                tbody.innerHTML = `<tr><td colspan="9" style="text-align: center; padding: 40px; color: #6c757d;">‡¶ï‡ßã‡¶® ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø</td></tr>`;
                return;
            }
            
            tbody.innerHTML = filtered.map(order => {
                let badgeClass = '';
                let statusText = '';
                
                switch(order.status) {
                    case 'pending':
                        badgeClass = 'badge-pending';
                        statusText = '‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç';
                        break;
                    case 'processing':
                        badgeClass = 'badge-processing';
                        statusText = '‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏‡¶ø‡¶Ç';
                        break;
                    case 'completed':
                        badgeClass = 'badge-completed';
                        statusText = '‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£';
                        break;
                    case 'delivered':
                        badgeClass = 'badge-delivered';
                        statusText = '‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡ßç‡¶°';
                        break;
                    case 'cancelled':
                        badgeClass = 'badge-cancelled';
                        statusText = '‡¶¨‡¶æ‡¶§‡¶ø‡¶≤';
                        break;
                }
                
                const priorityClass = `priority-${order.priority}`;
                
                return `
                <tr class="${priorityClass}">
                    <td>#${order.id}</td>
                    <td>${order.customerName}</td>
                    <td>${order.serviceName}</td>
                    <td>${order.quantity}</td>
                    <td style="font-weight: bold;">‡ß≥ ${order.totalPrice.toLocaleString('bn-BD')}</td>
                    <td><span class="badge ${badgeClass}">${statusText}</span></td>
                    <td>${order.priority === 'high' ? '‡¶â‡¶ö‡ßç‡¶ö' : order.priority === 'medium' ? '‡¶Æ‡¶æ‡¶ß‡ßç‡¶Ø‡¶Æ‡¶ø‡¶ï' : '‡¶®‡¶ø‡¶Æ‡ßç‡¶®'}</td>
                    <td>${order.deliveryDate ? formatDate(order.deliveryDate) : '‡¶®‡¶ø‡¶∞‡ßç‡¶ß‡¶æ‡¶∞‡¶ø‡¶§ ‡¶®‡¶Ø‡¶º'}</td>
                    <td>
                        <button class="btn btn-sm" onclick="viewOrderDetails(${order.id})">üëÅÔ∏è ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§</button>
                        <button class="btn btn-sm" onclick="updateOrderStatus(${order.id})" ${currentUser.role === 'staff' ? '' : 'disabled'}>üîÑ ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ</button>
                    </td>
                </tr>
                `;
            }).join('');
        }

        function viewOrderDetails(id) {
            const order = orders.find(o => o.id === id);
            if (!order) return;
            
            const customer = customers.find(c => c.id == order.customerId);
            const service = services.find(s => s.id == order.serviceId);
            
            let timelineHtml = '';
            order.timeline.forEach(item => {
                let statusText = '';
                switch(item.status) {
                    case 'pending': statusText = '‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç'; break;
                    case 'processing': statusText = '‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏‡¶ø‡¶Ç'; break;
                    case 'completed': statusText = '‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£'; break;
                    case 'delivered': statusText = '‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡ßç‡¶°'; break;
                    case 'cancelled': statusText = '‡¶¨‡¶æ‡¶§‡¶ø‡¶≤'; break;
                }
                
                timelineHtml += `
                <div class="timeline-item">
                    <div class="timeline-dot"></div>
                    <div class="timeline-content">
                        <div>${statusText} - ${item.note}</div>
                        <div class="timeline-date">${formatDateTime(item.date)}</div>
                    </div>
                </div>
                `;
            });
            
            document.getElementById('orderModalTitle').textContent = `‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ #${order.id} ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§`;
            document.getElementById('orderModalContent').innerHTML = `
                <div>
                    <h4>‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶§‡¶•‡ßç‡¶Ø</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;">
                        <div><strong>‡¶®‡¶æ‡¶Æ:</strong> ${customer.name}</div>
                        <div><strong>‡¶´‡ßã‡¶®:</strong> ${customer.phone}</div>
                        <div><strong>‡¶á‡¶Æ‡ßá‡¶á‡¶≤:</strong> ${customer.email || '‡¶®‡ßá‡¶á'}</div>
                        <div><strong>‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ:</strong> ${customer.address || '‡¶®‡ßá‡¶á'}</div>
                    </div>
                    
                    <h4>‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶§‡¶•‡ßç‡¶Ø</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;">
                        <div><strong>‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏:</strong> ${service.name}</div>
                        <div><strong>‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø:</strong> ${service.category}</div>
                        <div><strong>‡¶á‡¶â‡¶®‡¶ø‡¶ü ‡¶¶‡¶æ‡¶Æ:</strong> ‡ß≥ ${service.price.toLocaleString('bn-BD')}</div>
                        <div><strong>‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£:</strong> ${order.quantity}</div>
                        <div><strong>‡¶Æ‡ßã‡¶ü ‡¶¶‡¶æ‡¶Æ:</strong> ‡ß≥ ${order.totalPrice.toLocaleString('bn-BD')}</div>
                    </div>
                    
                    <h4>‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;">
                        <div><strong>‡¶Ö‡¶ó‡ßç‡¶∞‡¶æ‡¶ß‡¶ø‡¶ï‡¶æ‡¶∞:</strong> ${order.priority === 'high' ? '‡¶â‡¶ö‡ßç‡¶ö' : order.priority === 'medium' ? '‡¶Æ‡¶æ‡¶ß‡ßç‡¶Ø‡¶Æ‡¶ø‡¶ï' : '‡¶®‡¶ø‡¶Æ‡ßç‡¶®'}</div>
                        <div><strong>‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ:</strong> ${order.deliveryDate ? formatDate(order.deliveryDate) : '‡¶®‡¶ø‡¶∞‡ßç‡¶ß‡¶æ‡¶∞‡¶ø‡¶§ ‡¶®‡¶Ø‡¶º'}</div>
                        <div><strong>‡¶§‡ßà‡¶∞‡¶ø ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ:</strong> ${formatDateTime(order.createdAt)}</div>
                        <div><strong>‡¶∏‡¶∞‡ßç‡¶¨‡¶∂‡ßá‡¶∑ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü:</strong> ${formatDateTime(order.updatedAt)}</div>
                    </div>
                    
                    ${order.instructions ? `
                    <h4>‡¶¨‡¶ø‡¶∂‡ßá‡¶∑ ‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡ßá‡¶∂‡¶®‡¶æ</h4>
                    <div style="background: #f8f9fa; padding: 10px; border-radius: 6px; margin-bottom: 15px;">
                        ${order.instructions}
                    </div>
                    ` : ''}
                    
                    <h4>‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶ü‡¶æ‡¶á‡¶Æ‡¶≤‡¶æ‡¶á‡¶®</h4>
                    <div class="order-timeline">
                        ${timelineHtml}
                    </div>
                </div>
            `;
            
            document.getElementById('orderModal').style.display = 'block';
        }

        function closeOrderModal() {
            document.getElementById('orderModal').style.display = 'none';
        }

        async function updateOrderStatus(id) {
            const order = orders.find(o => o.id === id);
            if (!order) return;
            
            const currentStatus = order.status;
            let newStatus = '';
            let note = '';
            
            switch(currentStatus) {
                case 'pending':
                    newStatus = 'processing';
                    note = '‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏‡¶ø‡¶Ç ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá';
                    break;
                case 'processing':
                    newStatus = 'completed';
                    note = '‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá';
                    break;
                case 'completed':
                    newStatus = 'delivered';
                    note = '‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá';
                    break;
                default:
                    return;
            }
            
            order.status = newStatus;
            order.updatedAt = new Date().toISOString();
            order.timeline.push({
                status: newStatus,
                date: new Date().toISOString(),
                note: note
            });
            
            const success = await updateInFirebase('orders', id, order);
            if (success) {
                alert(`‚úÖ ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ #${id} ‡¶è‡¶∞ ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!`);
            } else {
                alert(`‚ùå ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ #${id} ‡¶è‡¶∞ ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!`);
            }
        }

        // ‡¶á‡¶®‡¶≠‡ßá‡¶®‡ßç‡¶ü‡¶∞‡¶ø ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü
        async function addMaterial(e) {
            e.preventDefault();
            
            const material = {
                name: document.getElementById('materialName').value,
                category: document.getElementById('materialCategory').value,
                quantity: parseFloat(document.getElementById('materialQuantity').value),
                unit: document.getElementById('materialUnit').value,
                alertLevel: parseFloat(document.getElementById('materialAlertLevel').value) || 0
            };
            
            const newId = await pushToFirebase('materials', material);
            if (newId) {
                e.target.reset();
                alert('‚úÖ ‡¶â‡¶™‡¶ï‡¶∞‡¶£ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
            } else {
                alert('‚ùå ‡¶â‡¶™‡¶ï‡¶∞‡¶£ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
            }
        }

        function renderMaterials() {
            const container = document.getElementById('materialsGrid');
            
            if (materials.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üì¶</div><h3>‡¶ï‡ßã‡¶® ‡¶â‡¶™‡¶ï‡¶∞‡¶£ ‡¶®‡ßá‡¶á</h3><p>‡¶®‡¶§‡ßÅ‡¶® ‡¶â‡¶™‡¶ï‡¶∞‡¶£ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</p></div>';
                return;
            }
            
            container.innerHTML = materials.map(material => {
                const stockClass = material.alertLevel > 0 && material.quantity <= material.alertLevel ? 'stock-low' : 'stock-ok';
                
                return `
                    <div class="material-card">
                        <div class="card-header">
                            <div class="card-avatar">${material.name.charAt(0)}</div>
                            <div class="card-info">
                                <h3>${material.name}</h3>
                                <p>${material.category}</p>
                            </div>
                        </div>
                        <div class="material-stock">
                            <div class="stock-item">
                                <span>‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶∏‡ßç‡¶ü‡¶ï:</span>
                                <span class="${stockClass}">${material.quantity} ${material.unit || ''}</span>
                            </div>
                            ${material.alertLevel > 0 ? `
                            <div class="stock-item">
                                <span>‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶§‡¶æ ‡¶∏‡ßç‡¶§‡¶∞:</span>
                                <span>${material.alertLevel} ${material.unit || ''}</span>
                            </div>
                            ` : ''}
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-sm" onclick="editMaterial(${material.id})" ${currentUser.role === 'staff' ? 'disabled' : ''}>‚úèÔ∏è ‡¶∏‡¶Æ‡ßç‡¶™‡¶æ‡¶¶‡¶®‡¶æ</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteMaterial(${material.id})" ${currentUser.role === 'staff' ? 'disabled' : ''}>üóëÔ∏è ‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        async function editMaterial(id) {
            const material = materials.find(m => m.id === id);
            if (material) {
                document.getElementById('materialName').value = material.name;
                document.getElementById('materialCategory').value = material.category;
                document.getElementById('materialQuantity').value = material.quantity;
                document.getElementById('materialUnit').value = material.unit;
                document.getElementById('materialAlertLevel').value = material.alertLevel;
                
                // Scroll to form
                document.getElementById('materialName').scrollIntoView({ behavior: 'smooth' });
                
                // Remove material from Firebase
                await deleteFromFirebase('materials', id);
            }
        }

        async function deleteMaterial(id) {
            if (confirm('‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§?')) {
                const success = await deleteFromFirebase('materials', id);
                if (success) {
                    alert('‚úÖ ‡¶â‡¶™‡¶ï‡¶∞‡¶£ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
                } else {
                    alert('‚ùå ‡¶â‡¶™‡¶ï‡¶∞‡¶£ ‡¶Æ‡ßÅ‡¶õ‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
                }
            }
        }

        // ‡¶Ü‡¶∞‡ßç‡¶•‡¶ø‡¶ï ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü
        async function addIncome(e) {
            e.preventDefault();
            
            const income = {
                type: 'income',
                date: document.getElementById('incomeDate').value,
                amount: parseFloat(document.getElementById('incomeAmount').value),
                category: document.getElementById('incomeType').value,
                description: document.getElementById('incomeDescription').value,
                createdAt: new Date().toISOString()
            };
            
            const newId = await pushToFirebase('finances', income);
            if (newId) {
                e.target.reset();
                setDefaultDate();
                alert('‚úÖ ‡¶Ü‡¶Ø‡¶º ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
            } else {
                alert('‚ùå ‡¶Ü‡¶Ø‡¶º ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
            }
        }

        async function addExpense(e) {
            e.preventDefault();
            
            const expense = {
                type: 'expense',
                date: document.getElementById('expenseDate').value,
                amount: parseFloat(document.getElementById('expenseAmount').value),
                category: document.getElementById('expenseType').value,
                description: document.getElementById('expenseDescription').value,
                createdAt: new Date().toISOString()
            };
            
            const newId = await pushToFirebase('finances', expense);
            if (newId) {
                e.target.reset();
                setDefaultDate();
                alert('‚úÖ ‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
            } else {
                alert('‚ùå ‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
            }
        }

        function renderFinances() {
            const totalIncome = finances.filter(f => f.type === 'income').reduce((sum, f) => sum + f.amount, 0);
            const totalExpense = finances.filter(f => f.type === 'expense').reduce((sum, f) => sum + f.amount, 0);
            const netProfit = totalIncome - totalExpense;
            
            document.getElementById('totalIncome').textContent = totalIncome.toLocaleString('bn-BD');
            document.getElementById('totalExpense').textContent = totalExpense.toLocaleString('bn-BD');
            document.getElementById('netProfit').textContent = netProfit.toLocaleString('bn-BD');
        }

        // ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°
        function updateDashboard() {
            const today = new Date().toISOString().split('T')[0];
            const todayOrders = orders.filter(o => o.createdAt.split('T')[0] === today).length;
            const pendingOrders = orders.filter(o => o.status === 'pending').length;
            
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            const monthlyIncome = finances
                .filter(f => f.type === 'income' && new Date(f.date).getMonth() === currentMonth && new Date(f.date).getFullYear() === currentYear)
                .reduce((sum, f) => sum + f.amount, 0);
            
            document.getElementById('todayOrders').textContent = todayOrders;
            document.getElementById('pendingOrders').textContent = pendingOrders;
            document.getElementById('monthlyIncome').textContent = monthlyIncome.toLocaleString('bn-BD');
            document.getElementById('totalCustomers').textContent = customers.length;
            
            updateCharts();
        }

        function updateCharts() {
            // ‡¶∏‡¶æ‡¶™‡ßç‡¶§‡¶æ‡¶π‡¶ø‡¶ï ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶ö‡¶æ‡¶∞‡ßç‡¶ü
            const last7Days = [];
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                last7Days.push(date.toISOString().split('T')[0]);
            }
            
            const weeklyOrdersData = last7Days.map(date => {
                return orders.filter(o => o.createdAt.split('T')[0] === date).length;
            });
            
            const weeklyCtx = document.getElementById('weeklyOrdersChart').getContext('2d');
            if (weeklyOrdersChart) weeklyOrdersChart.destroy();
            
            weeklyOrdersChart = new Chart(weeklyCtx, {
                type: 'bar',
                data: {
                    labels: last7Days.map(d => formatDate(d)),
                    datasets: [{
                        label: '‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ',
                        data: weeklyOrdersData,
                        backgroundColor: '#667eea',
                        borderColor: '#667eea',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: { display: true, text: '‡¶∏‡¶™‡ßç‡¶§‡¶æ‡¶π‡ßá‡¶∞ ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞' }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
            
            // ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶Ü‡¶Ø‡¶º ‡¶ö‡¶æ‡¶∞‡ßç‡¶ü
            const serviceRevenue = {};
            orders.forEach(order => {
                if (!serviceRevenue[order.serviceName]) {
                    serviceRevenue[order.serviceName] = 0;
                }
                serviceRevenue[order.serviceName] += order.totalPrice;
            });
            
            const serviceCtx = document.getElementById('serviceRevenueChart').getContext('2d');
            if (serviceRevenueChart) serviceRevenueChart.destroy();
            
            serviceRevenueChart = new Chart(serviceCtx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(serviceRevenue),
                    datasets: [{
                        label: '‡¶Ü‡¶Ø‡¶º',
                        data: Object.values(serviceRevenue),
                        backgroundColor: [
                            '#667eea', '#764ba2', '#28a745', '#dc3545', '#ffc107', 
                            '#17a2b8', '#6c757d', '#343a40', '#007bff', '#6610f2'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: { display: true, text: '‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡¶Ø‡¶º‡ßÄ ‡¶Ü‡¶Ø‡¶º' },
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü
        function generateReport() {
            const startDate = document.getElementById('reportStartDate').value;
            const endDate = document.getElementById('reportEndDate').value;
            const reportType = document.getElementById('reportType').value;
            
            let html = '<div class="form-card">';
            
            if (reportType === 'orders') {
                html += '<h3>‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</h3>';
                
                let filteredOrders = orders;
                if (startDate && endDate) {
                    filteredOrders = orders.filter(o => {
                        const orderDate = o.createdAt.split('T')[0];
                        return orderDate >= startDate && orderDate <= endDate;
                    });
                }
                
                const totalOrders = filteredOrders.length;
                const totalRevenue = filteredOrders.reduce((sum, o) => sum + o.totalPrice, 0);
                const completedOrders = filteredOrders.filter(o => o.status === 'completed' || o.status === 'delivered').length;
                
                html += `
                <div class="stats-grid">
                    <div class="stat-card green">
                        <h3>‡¶Æ‡ßã‡¶ü ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞</h3>
                        <div class="amount">${totalOrders}</div>
                    </div>
                    <div class="stat-card blue">
                        <h3>‡¶Æ‡ßã‡¶ü ‡¶Ü‡¶Ø‡¶º</h3>
                        <div class="amount">‡ß≥ ${totalRevenue.toLocaleString('bn-BD')}</div>
                    </div>
                    <div class="stat-card purple">
                        <h3>‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞</h3>
                        <div class="amount">${completedOrders}</div>
                    </div>
                </div>
                `;
                
                html += '<h4>‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</h4>';
                html += '<div style="overflow-x: auto;">';
                html += '<table class="transactions-table">';
                html += '<thead><tr><th>‡¶Ü‡¶á‡¶°‡¶ø</th><th>‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï</th><th>‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏</th><th>‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</th><th>‡¶¶‡¶æ‡¶Æ</th><th>‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ</th><th>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th></tr></thead>';
                html += '<tbody>';
                
                filteredOrders.forEach(order => {
                    html += `
                    <tr>
                        <td>#${order.id}</td>
                        <td>${order.customerName}</td>
                        <td>${order.serviceName}</td>
                        <td>${order.quantity}</td>
                        <td>‡ß≥ ${order.totalPrice.toLocaleString('bn-BD')}</td>
                        <td>${order.status}</td>
                        <td>${formatDate(order.createdAt.split('T')[0])}</td>
                    </tr>
                    `;
                });
                
                html += '</tbody></table></div>';
            }
            
            html += '</div>';
            document.getElementById('reportResults').innerHTML = html;
        }

        function exportReportToExcel() {
            alert('üìä ‡¶è‡¶ï‡ßç‡¶∏‡ßá‡¶≤ ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶π‡¶¨‡ßá!');
        }

        // ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏
        async function saveBusinessInfo(e) {
            e.preventDefault();
            
            businessSettings.businessName = document.getElementById('businessName').value;
            businessSettings.businessAddress = document.getElementById('businessAddress').value;
            businessSettings.businessPhone = document.getElementById('businessPhone').value;
            businessSettings.businessEmail = document.getElementById('businessEmail').value;
            
            const success = await saveToFirebase('businessSettings', businessSettings);
            if (success) {
                alert('‚úÖ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡¶æ ‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
            } else {
                alert('‚ùå ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡¶æ ‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
            }
        }

        // ‡¶®‡¶§‡ßÅ‡¶® ‡¶´‡¶ø‡¶ö‡¶æ‡¶∞: ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü
        function renderUsers() {
            const container = document.getElementById('usersGrid');
            const users = getUsers();
            
            if (Object.keys(users).length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üë•</div><h3>‡¶ï‡ßã‡¶® ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶®‡ßá‡¶á</h3><p>‡¶®‡¶§‡ßÅ‡¶® ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</p></div>';
                return;
            }
            
            container.innerHTML = Object.keys(users).map(username => {
                const user = users[username];
                return `
                    <div class="user-card">
                        <div class="card-header">
                            <div class="card-avatar">${user.name.charAt(0)}</div>
                            <div class="card-info">
                                <h3>${user.name}</h3>
                                <p>@${username}</p>
                                <span class="status-badge ${user.isActive ? 'status-active' : 'status-inactive'}">
                                    ${user.isActive ? '‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º' : '‡¶®‡¶ø‡¶∑‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º'}
                                </span>
                            </div>
                        </div>
                        <div style="margin: 15px 0;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span>üìß ‡¶á‡¶Æ‡ßá‡¶á‡¶≤:</span>
                                <span>${user.email || '‡¶®‡ßá‡¶á'}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span>üìû ‡¶´‡ßã‡¶®:</span>
                                <span>${user.phone || '‡¶®‡ßá‡¶á'}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span>üë§ ‡¶∞‡ßã‡¶≤:</span>
                                <span>${user.role === 'admin' ? '‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®' : user.role === 'manager' ? '‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶æ‡¶∞' : '‡¶∏‡ßç‡¶ü‡¶æ‡¶´'}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>üìÖ ‡¶Ø‡ßã‡¶ó‡¶¶‡¶æ‡¶®:</span>
                                <span>${formatDate(user.createdAt.split('T')[0])}</span>
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-sm" onclick="editUser('${username}')">‚úèÔ∏è ‡¶∏‡¶Æ‡ßç‡¶™‡¶æ‡¶¶‡¶®‡¶æ</button>
                            <button class="btn btn-warning btn-sm" onclick="toggleUserStatus('${username}')">
                                ${user.isActive ? 'üö´ ‡¶®‡¶ø‡¶∑‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º' : '‚úÖ ‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º'}
                            </button>
                            <button class="btn btn-danger btn-sm" onclick="deleteUser('${username}')" ${username === currentUser.username ? 'disabled' : ''}>üóëÔ∏è ‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function editUser(username) {
            const users = getUsers();
            const user = users[username];
            
            if (user) {
                document.getElementById('userUsername').value = username;
                document.getElementById('userUsername').disabled = true;
                document.getElementById('userPassword').value = user.password;
                document.getElementById('userName').value = user.name;
                document.getElementById('userEmail').value = user.email || '';
                document.getElementById('userPhone').value = user.phone || '';
                document.getElementById('userRole').value = user.role;
                
                // Scroll to form
                document.getElementById('userUsername').scrollIntoView({ behavior: 'smooth' });
            }
        }

        async function toggleUserStatus(username) {
            const usersSnapshot = await usersRef.once('value');
            const firebaseUsers = usersSnapshot.val() || {};
            
            if (firebaseUsers[username]) {
                firebaseUsers[username].isActive = !firebaseUsers[username].isActive;
                const success = await saveToFirebase('users', firebaseUsers);
                if (success) {
                    renderUsers();
                    alert(`‚úÖ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ${firebaseUsers[username].isActive ? '‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º' : '‡¶®‡¶ø‡¶∑‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º'} ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!`);
                } else {
                    alert('‚ùå ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
                }
            }
        }

        async function deleteUser(username) {
            if (confirm('‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§?')) {
                const usersSnapshot = await usersRef.once('value');
                const firebaseUsers = usersSnapshot.val() || {};
                
                delete firebaseUsers[username];
                const success = await saveToFirebase('users', firebaseUsers);
                
                if (success) {
                    renderUsers();
                    alert('‚úÖ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
                } else {
                    alert('‚ùå ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Æ‡ßÅ‡¶õ‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
                }
            }
        }

        // ‡¶®‡¶§‡ßÅ‡¶® ‡¶´‡¶ø‡¶ö‡¶æ‡¶∞: ‡¶∞‡¶ø‡¶∏‡¶ø‡¶™‡ßç‡¶ü ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü
        function updateReceiptOrderSelect() {
            const select = document.getElementById('receiptOrder');
            select.innerHTML = '<option value="">‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>';
            
            orders.forEach(order => {
                const option = document.createElement('option');
                option.value = order.id;
                option.textContent = `#${order.id} - ${order.customerName} - ‡ß≥${order.totalPrice}`;
                option.setAttribute('data-order', JSON.stringify(order));
                select.appendChild(option);
            });
        }

        async function generateReceipt(e) {
            e.preventDefault();
            
            const orderId = document.getElementById('receiptOrder').value;
            const receiptType = document.getElementById('receiptType').value;
            const paidAmount = parseFloat(document.getElementById('receiptPaidAmount').value) || 0;
            
            const order = orders.find(o => o.id == orderId);
            if (!order) {
                alert('‚ùå ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø!');
                return;
            }
            
            const customer = customers.find(c => c.id == order.customerId);
            const service = services.find(s => s.id == order.serviceId);
            
            // Calculate due amount
            const previousReceipts = receipts.filter(r => r.orderId == orderId);
            const totalPaid = previousReceipts.reduce((sum, r) => sum + r.paidAmount, 0);
            const dueAmount = order.totalPrice - totalPaid;
            
            let finalPaidAmount = paidAmount;
            if (receiptType === 'full') {
                finalPaidAmount = dueAmount;
            } else if (receiptType === 'partial' && paidAmount <= 0) {
                alert('‚ùå ‡¶Ü‡¶Ç‡¶∂‡¶ø‡¶ï ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®!');
                return;
            }
            
            if (finalPaidAmount > dueAmount) {
                alert('‚ùå ‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß‡¶ø‡¶§ Amount ‡¶¨‡¶æ‡¶ï‡¶ø‡¶∞ ‡¶ö‡ßá‡¶Ø‡¶º‡ßá ‡¶¨‡ßá‡¶∂‡¶ø ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá ‡¶®‡¶æ!');
                return;
            }
            
            // Create receipt
            const receipt = {
                orderId: orderId,
                receiptType: receiptType,
                paidAmount: finalPaidAmount,
                previousDue: dueAmount,
                newDue: dueAmount - finalPaidAmount,
                createdAt: new Date().toISOString(),
                receiptNumber: 'RCP' + Date.now()
            };
            
            const newId = await pushToFirebase('receipts', receipt);
            if (newId) {
                // Display receipt
                displayReceipt(receipt, order, customer, service);
                alert('‚úÖ ‡¶∞‡¶ø‡¶∏‡¶ø‡¶™‡ßç‡¶ü ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
            } else {
                alert('‚ùå ‡¶∞‡¶ø‡¶∏‡¶ø‡¶™‡ßç‡¶ü ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
            }
        }

        function displayReceipt(receipt, order, customer, service) {
            const container = document.getElementById('receiptContainer');
            
            const receiptHtml = `
                <div class="receipt-container" id="printableReceipt">
                    <div class="receipt-header">
                        <h2>${businessSettings.businessName || '‡¶∏‡¶æ‡¶≤‡ßá‡¶π ‡¶∏‡ßç‡¶ü‡ßÅ‡¶°‡¶ø‡¶ì'}</h2>
                        <p>${businessSettings.businessAddress || ''}</p>
                        <p>‡¶´‡ßã‡¶®: ${businessSettings.businessPhone || ''}</p>
                        <h3>‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∞‡¶ø‡¶∏‡¶ø‡¶™‡ßç‡¶ü</h3>
                        <p>‡¶∞‡¶ø‡¶∏‡¶ø‡¶™‡ßç‡¶ü ‡¶®‡¶Ç: ${receipt.receiptNumber}</p>
                        <p>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ: ${formatDateTime(receipt.createdAt)}</p>
                    </div>
                    
                    <div class="receipt-details">
                        <div>
                            <strong>‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ:</strong> ${customer.name}
                        </div>
                        <div>
                            <strong>‡¶´‡ßã‡¶®:</strong> ${customer.phone}
                        </div>
                        <div>
                            <strong>‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶®‡¶Ç:</strong> #${order.id}
                        </div>
                        <div>
                            <strong>‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏:</strong> ${service.name}
                        </div>
                    </div>
                    
                    <table class="receipt-items">
                        <thead>
                            <tr>
                                <th>‡¶¨‡¶ø‡¶¨‡¶∞‡¶£</th>
                                <th>‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</th>
                                <th>‡¶¶‡¶æ‡¶Æ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>${service.name}</td>
                                <td>${order.quantity}</td>
                                <td>‡ß≥ ${order.unitPrice.toLocaleString('bn-BD')}</td>
                            </tr>
                            <tr>
                                <td colspan="2" style="text-align: right;"><strong>‡¶∏‡¶æ‡¶¨‡¶ü‡ßã‡¶ü‡¶æ‡¶≤:</strong></td>
                                <td><strong>‡ß≥ ${order.totalPrice.toLocaleString('bn-BD')}</strong></td>
                            </tr>
                            <tr>
                                <td colspan="2" style="text-align: right;"><strong>‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡ßá‡¶∞ ‡¶¨‡¶æ‡¶ï‡¶ø:</strong></td>
                                <td><strong>‡ß≥ ${receipt.previousDue.toLocaleString('bn-BD')}</strong></td>
                            </tr>
                            <tr>
                                <td colspan="2" style="text-align: right;"><strong>‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß‡¶ø‡¶§:</strong></td>
                                <td><strong>‡ß≥ ${receipt.paidAmount.toLocaleString('bn-BD')}</strong></td>
                            </tr>
                            <tr>
                                <td colspan="2" style="text-align: right;"><strong>‡¶®‡¶§‡ßÅ‡¶® ‡¶¨‡¶æ‡¶ï‡¶ø:</strong></td>
                                <td><strong>‡ß≥ ${receipt.newDue.toLocaleString('bn-BD')}</strong></td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div class="receipt-total">
                        <p>‡¶Æ‡ßã‡¶ü ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø: ‡ß≥ ${order.totalPrice.toLocaleString('bn-BD')}</p>
                        <p>‡¶∏‡¶∞‡ßç‡¶¨‡¶Æ‡ßã‡¶ü ‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß‡¶ø‡¶§: ‡ß≥ ${receipt.paidAmount.toLocaleString('bn-BD')}</p>
                        <p>‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶¨‡¶æ‡¶ï‡¶ø: ‡ß≥ ${receipt.newDue.toLocaleString('bn-BD')}</p>
                    </div>
                    
                    <div style="text-align: center; margin-top: 20px; padding-top: 15px; border-top: 1px dashed #dee2e6;">
                        <p>‡¶ß‡¶®‡ßç‡¶Ø‡¶¨‡¶æ‡¶¶‡¶æ‡¶®‡ßç‡¶§‡ßá,</p>
                        <p><strong>${businessSettings.businessName || '‡¶∏‡¶æ‡¶≤‡ßá‡¶π ‡¶∏‡ßç‡¶ü‡ßÅ‡¶°‡¶ø‡¶ì'}</strong></p>
                    </div>
                </div>
            `;
            
            container.innerHTML = receiptHtml;
            container.style.display = 'block';
        }

        function printReceipt() {
            const receiptElement = document.getElementById('printableReceipt');
            if (!receiptElement) {
                alert('‚ùå ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá ‡¶∞‡¶ø‡¶∏‡¶ø‡¶™‡ßç‡¶ü ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®!');
                return;
            }
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                    <head>
                        <title>‡¶∞‡¶ø‡¶∏‡¶ø‡¶™‡ßç‡¶ü ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü</title>
                        <style>
                            body { font-family: Arial, sans-serif; margin: 20px; }
                            .receipt-container { max-width: 500px; margin: 0 auto; }
                            .receipt-header { text-align: center; border-bottom: 2px dashed #000; padding-bottom: 15px; margin-bottom: 15px; }
                            .receipt-details { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
                            .receipt-items { width: 100%; border-collapse: collapse; margin-bottom: 15px; }
                            .receipt-items th, .receipt-items td { padding: 8px; border-bottom: 1px solid #000; text-align: left; }
                            .receipt-total { text-align: right; font-weight: bold; font-size: 18px; margin-top: 10px; padding-top: 10px; border-top: 2px solid #000; }
                            @media print {
                                body { margin: 0; }
                                .receipt-container { box-shadow: none; border: none; }
                            }
                        </style>
                    </head>
                    <body>
                        ${receiptElement.innerHTML}
                    </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        // ‡¶®‡¶§‡ßÅ‡¶® ‡¶´‡¶ø‡¶ö‡¶æ‡¶∞: ‡¶ï‡ßç‡¶∞‡ßá‡¶°‡¶ø‡¶ü ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü
        function updateCreditCustomerSelect() {
            const select = document.getElementById('creditCustomer');
            select.innerHTML = '<option value="">‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>';
            
            customers.forEach(customer => {
                const option = document.createElement('option');
                option.value = customer.id;
                option.textContent = `${customer.name} (${customer.phone}) - ‡¶¨‡¶æ‡¶ï‡¶ø: ‡ß≥${customer.creditBalance || 0}`;
                select.appendChild(option);
            });
        }

        async function addCreditTransaction(e) {
            e.preventDefault();
            
            const customerId = document.getElementById('creditCustomer').value;
            const type = document.getElementById('creditType').value;
            const amount = parseFloat(document.getElementById('creditAmount').value);
            const date = document.getElementById('creditDate').value;
            const description = document.getElementById('creditDescription').value;
            
            if (!customerId || amount <= 0) {
                alert('‚ùå ‡¶∏‡¶ï‡¶≤ ‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡¶†‡¶ø‡¶ï‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®!');
                return;
            }
            
            const customer = customers.find(c => c.id == customerId);
            if (!customer) {
                alert('‚ùå ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø!');
                return;
            }
            
            // Update customer credit balance
            if (type === 'due') {
                customer.creditBalance = (customer.creditBalance || 0) + amount;
            } else if (type === 'payment') {
                if (amount > (customer.creditBalance || 0)) {
                    alert('‚ùå ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü Amount ‡¶¨‡¶æ‡¶ï‡¶ø‡¶∞ ‡¶ö‡ßá‡¶Ø‡¶º‡ßá ‡¶¨‡ßá‡¶∂‡¶ø ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá ‡¶®‡¶æ!');
                    return;
                }
                customer.creditBalance = (customer.creditBalance || 0) - amount;
            }
            
            // Add credit transaction
            const transaction = {
                customerId: customerId,
                type: type,
                amount: amount,
                date: date,
                description: description,
                previousBalance: (customer.creditBalance || 0) - (type === 'due' ? -amount : amount),
                newBalance: customer.creditBalance,
                createdAt: new Date().toISOString()
            };
            
            // Update customer in Firebase
            await updateInFirebase('customers', customerId, customer);
            
            // Add credit transaction to Firebase
            const newId = await pushToFirebase('creditTransactions', transaction);
            
            if (newId) {
                e.target.reset();
                setDefaultDate();
                alert('‚úÖ ‡¶ï‡ßç‡¶∞‡ßá‡¶°‡¶ø‡¶ü ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
            } else {
                alert('‚ùå ‡¶ï‡ßç‡¶∞‡ßá‡¶°‡¶ø‡¶ü ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
            }
        }

        function showCreditHistory(customerId) {
            const customer = customers.find(c => c.id == customerId);
            if (!customer) return;
            
            const customerTransactions = creditTransactions.filter(t => t.customerId == customerId);
            
            let historyHtml = `
                <h3>${customer.name} - ‡¶¨‡¶æ‡¶ï‡¶ø ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡¶∞‡¶ø</h3>
                <p>‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶¨‡¶æ‡¶ï‡¶ø: ‡ß≥ ${customer.creditBalance || 0}</p>
            `;
            
            if (customerTransactions.length === 0) {
                historyHtml += '<p>‡¶ï‡ßã‡¶® ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶®‡ßá‡¶á</p>';
            } else {
                historyHtml += `
                    <table class="transactions-table">
                        <thead>
                            <tr>
                                <th>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th>
                                <th>‡¶ß‡¶∞‡¶®</th>
                                <th>‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</th>
                                <th>‡¶¨‡¶ø‡¶¨‡¶∞‡¶£</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                customerTransactions.forEach(transaction => {
                    historyHtml += `
                        <tr>
                            <td>${formatDate(transaction.date)}</td>
                            <td>${transaction.type === 'due' ? '‡¶¨‡¶æ‡¶ï‡¶ø ‡¶Ø‡ßã‡¶ó' : '‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü'}</td>
                            <td>‡ß≥ ${transaction.amount.toLocaleString('bn-BD')}</td>
                            <td>${transaction.description || ''}</td>
                        </tr>
                    `;
                });
                
                historyHtml += '</tbody></table>';
            }
            
            document.getElementById('orderModalTitle').textContent = '‡¶¨‡¶æ‡¶ï‡¶ø ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡¶∞‡¶ø';
            document.getElementById('orderModalContent').innerHTML = historyHtml;
            document.getElementById('orderModal').style.display = 'block';
        }

        // ‡¶®‡¶§‡ßÅ‡¶® ‡¶´‡¶ø‡¶ö‡¶æ‡¶∞: ‡¶è‡¶∏‡¶è‡¶Æ‡¶è‡¶∏ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®‡¶æ‡¶≤‡¶ø‡¶ü‡¶ø
        function showSMSModal(customerId) {
            const customer = customers.find(c => c.id == customerId);
            if (!customer) return;
            
            document.getElementById('smsCustomerId').value = customer.id;
            document.getElementById('smsCustomerName').value = customer.name;
            document.getElementById('smsCustomerPhone').value = customer.phone;
            document.getElementById('smsMessage').value = businessSettings.smsDefaultMessage || '‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡ßÅ‡¶§‡•§ ‡¶∏‡¶æ‡¶≤‡ßá‡¶π ‡¶∏‡ßç‡¶ü‡ßÅ‡¶°‡¶ø‡¶ì';
            
            document.getElementById('smsModal').style.display = 'block';
        }

        function closeSMSModal() {
            document.getElementById('smsModal').style.display = 'none';
        }

        function sendSMS(e) {
            e.preventDefault();
            
            const customerId = document.getElementById('smsCustomerId').value;
            const message = document.getElementById('smsMessage').value;
            
            const customer = customers.find(c => c.id == customerId);
            if (!customer) {
                alert('‚ùå ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø!');
                return;
            }
            
            // In a real application, you would integrate with an SMS gateway API here
            // For demo purposes, we'll just show a confirmation
            
            const phone = businessSettings.smsPhone || customer.phone;
            if (!phone) {
                alert('‚ùå ‡¶è‡¶∏‡¶è‡¶Æ‡¶è‡¶∏ ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶´‡ßã‡¶® ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®!');
                return;
            }
            
            // Simulate SMS sending
            alert(`üì± ‡¶è‡¶∏‡¶è‡¶Æ‡¶è‡¶∏ ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡ßü‡ßá‡¶õ‡ßá!\n\n‡¶™‡ßç‡¶∞‡¶æ‡¶™‡¶ï: ${customer.name}\n‡¶´‡ßã‡¶®: ${phone}\n‡¶Æ‡ßá‡¶∏‡ßá‡¶ú: ${message}`);
            
            closeSMSModal();
        }

        async function saveSMSSettings(e) {
            e.preventDefault();
            
            businessSettings.smsPhone = document.getElementById('smsPhone').value;
            businessSettings.smsApiKey = document.getElementById('smsApiKey').value;
            businessSettings.smsDefaultMessage = document.getElementById('smsDefaultMessage').value;
            
            const success = await saveToFirebase('businessSettings', businessSettings);
            if (success) {
                alert('‚úÖ ‡¶è‡¶∏‡¶è‡¶Æ‡¶è‡¶∏ ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
            } else {
                alert('‚ùå ‡¶è‡¶∏‡¶è‡¶Æ‡¶è‡¶∏ ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
            }
        }

        function testSMS() {
            const testPhone = businessSettings.smsPhone;
            if (!testPhone) {
                alert('‚ùå ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá ‡¶ì‡¶Ø‡¶º‡¶æ‡¶ü‡¶∏‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™/‡¶è‡¶∏‡¶è‡¶Æ‡¶è‡¶∏ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®!');
                return;
            }
            
            alert(`üì± ‡¶ü‡ßá‡¶∏‡ßç‡¶ü ‡¶è‡¶∏‡¶è‡¶Æ‡¶è‡¶∏:\n\n‡¶´‡ßã‡¶®: ${testPhone}\n‡¶Æ‡ßá‡¶∏‡ßá‡¶ú: ${businessSettings.smsDefaultMessage || '‡¶ü‡ßá‡¶∏‡ßç‡¶ü ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú'}`);
        }

        // ‡¶á‡¶â‡¶ü‡¶ø‡¶≤‡¶ø‡¶ü‡¶ø ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
        function formatDate(dateStr) {
            const date = new Date(dateStr);
            const day = date.getDate().toString().replace(/0/g, '‡ß¶').replace(/1/g, '‡ßß').replace(/2/g, '‡ß®').replace(/3/g, '‡ß©').replace(/4/g, '‡ß™').replace(/5/g, '‡ß´').replace(/6/g, '‡ß¨').replace(/7/g, '‡ß≠').replace(/8/g, '‡ßÆ').replace(/9/g, '‡ßØ');
            const month = (date.getMonth() + 1).toString().replace(/0/g, '‡ß¶').replace(/1/g, '‡ßß').replace(/2/g, '‡ß®').replace(/3/g, '‡ß©').replace(/4/g, '‡ß™').replace(/5/g, '‡ß´').replace(/6/g, '‡ß¨').replace(/7/g, '‡ß≠').replace(/8/g, '‡ßÆ').replace(/9/g, '‡ßØ');
            const year = date.getFullYear().toString().replace(/0/g, '‡ß¶').replace(/1/g, '‡ßß').replace(/2/g, '‡ß®').replace(/3/g, '‡ß©').replace(/4/g, '‡ß™').replace(/5/g, '‡ß´').replace(/6/g, '‡ß¨').replace(/7/g, '‡ß≠').replace(/8/g, '‡ßÆ').replace(/9/g, '‡ßØ');
            return `${day}/${month}/${year}`;
        }

        function formatDateTime(dateTimeStr) {
            const date = new Date(dateTimeStr);
            return `${formatDate(dateTimeStr)} ${date.getHours().toString().replace(/0/g, '‡ß¶').replace(/1/g, '‡ßß').replace(/2/g, '‡ß®').replace(/3/g, '‡ß©').replace(/4/g, '‡ß™').replace(/5/g, '‡ß´').replace(/6/g, '‡ß¨').replace(/7/g, '‡ß≠').replace(/8/g, '‡ßÆ').replace(/9/g, '‡ßØ')}:${date.getMinutes().toString().padStart(2, '0').replace(/0/g, '‡ß¶').replace(/1/g, '‡ßß').replace(/2/g, '‡ß®').replace(/3/g, '‡ß©').replace(/4/g, '‡ß™').replace(/5/g, '‡ß´').replace(/6/g, '‡ß¨').replace(/7/g, '‡ß≠').replace(/8/g, '‡ßÆ').replace(/9/g, '‡ßØ')}`;
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            if (tabName === 'dashboard') {
                updateDashboard();
            } else if (tabName === 'services') {
                renderServices();
            } else if (tabName === 'orders') {
                renderOrders();
            } else if (tabName === 'customers') {
                renderCustomers();
            } else if (tabName === 'inventory') {
                renderMaterials();
            } else if (tabName === 'finance') {
                renderFinances();
            } else if (tabName === 'users') {
                renderUsers();
            }
        }

        // ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü ‡¶≤‡¶ø‡¶∏‡ßá‡¶®‡¶æ‡¶∞
        document.addEventListener('DOMContentLoaded', function() {
            // ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞
            document.getElementById('serviceCategories').addEventListener('click', function(e) {
                if (e.target.classList.contains('service-category')) {
                    document.querySelectorAll('.service-category').forEach(cat => {
                        cat.classList.remove('active');
                    });
                    e.target.classList.add('active');
                    renderServices();
                }
            });
        });

        // ‡¶Æ‡¶°‡¶æ‡¶≤ ‡¶¨‡¶æ‡¶á‡¶∞‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡¶≤‡ßá ‡¶¨‡¶®‡ßç‡¶ß
        window.onclick = function(event) {
            const customerModal = document.getElementById('customerModal');
            if (event.target === customerModal) {
                closeCustomerModal();
            }
            
            const orderModal = document.getElementById('orderModal');
            if (event.target === orderModal) {
                closeOrderModal();
            }
            
            const smsModal = document.getElementById('smsModal');
            if (event.target === smsModal) {
                closeSMSModal();
            }
        };
    </script>
</body>
</html>